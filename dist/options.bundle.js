(()=>{const e={get:e=>new Promise(t=>{(chrome.storage?.sync??chrome.storage?.local).get(e,e=>t(e||{}))}),set:e=>new Promise((t,n)=>{(chrome.storage?.sync??chrome.storage?.local).set(e,()=>{chrome.runtime.lastError?n(chrome.runtime.lastError):t()})}),remove:e=>new Promise((t,n)=>{(chrome.storage?.sync??chrome.storage?.local).remove(e,()=>{chrome.runtime.lastError?n(chrome.runtime.lastError):t()})})},t={enabled:!1,theme:"dark",searchIntervalMs:1200,defaultFilter:""},n=Object.keys(t);function r(e){return document.querySelector(e)}function o(e,t="info"){const n=document.createElement("div");n.className=`mb-toast mb-toast--${t}`,n.textContent=e,document.body.appendChild(n),requestAnimationFrame(()=>n.classList.add("is-visible")),setTimeout(()=>{n.classList.remove("is-visible"),setTimeout(()=>n.remove(),300)},2e3)}async function a(){const o=await e.get(n),a={...t,...o};r("#opt-enabled").checked=!!a.enabled,r("#opt-theme").value=a.theme,r("#opt-interval").value=String(a.searchIntervalMs),await async function(t){const n=r("#opt-default-filter");n.innerHTML="";const{savedFilters:o=[]}=await e.get(["savedFilters"]),a=o.length?o:["","Snipers","BPM Low","TradeList"];for(const e of a){const t=document.createElement("option");t.value=e,t.textContent=e||"— None —",n.appendChild(t)}null!=t&&(n.value=t)}(a.defaultFilter)}async function s(){try{const s=r("#opt-enabled").checked,i=r("#opt-theme").value;let c=parseInt(r("#opt-interval").value,10);const d=r("#opt-default-filter").value;if(!["dark","light","system"].includes(i))return void o("Tema inválido.","error");if(Number.isNaN(c))return void o("Intervalo inválido.","error");t=c,n=300,a=1e4,c=Math.max(n,Math.min(a,t)),await e.set({enabled:s,theme:i,searchIntervalMs:c,defaultFilter:d}),o("Settings saved","success")}catch(e){console.error(e),o("Error saving settings","error")}var t,n,a}function i(){r("#btn-save")?.addEventListener("click",e=>{e.preventDefault(),s()}),r("#btn-reset")?.addEventListener("click",r=>{r.preventDefault(),confirm("Restore default settings?")&&async function(){try{await e.remove(n),await e.set({...t}),await a(),o("Settings reset","success")}catch(e){console.error(e),o("Error resetting","error")}}()}),document.addEventListener("keydown",e=>{const t=document.activeElement;t&&("INPUT"===t.tagName||"SELECT"===t.tagName)&&"Enter"===e.key&&(e.preventDefault(),s())})}async function c(){!function(){const e=document.createElement("style");e.textContent='\n    :root { color-scheme: light dark; }\n    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; padding: 24px; }\n    .wrap { max-width: 860px; margin: 0 auto; }\n    h1 { margin: 0 0 16px; font-size: 20px; }\n    .card { background: rgba(0,0,0,0.05); border-radius: 10px; padding: 16px; margin-bottom: 16px; }\n    .row { display: grid; grid-template-columns: 240px 1fr; gap: 12px; align-items: center; margin-bottom: 12px; }\n    label { font-weight: 600; }\n    input[type="number"], select { width: 220px; padding: 8px; border-radius: 6px; border: 1px solid rgba(0,0,0,0.2); }\n    .actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 16px; }\n    .btn { padding: 8px 12px; border-radius: 8px; border: 0; cursor: pointer; }\n    .btn-primary { background: #2563eb; color: #fff; }\n    .btn-secondary { background: #374151; color: #fff; }\n    .hint { color: #6b7280; font-size: 12px; }\n    .mb-toast { \n      position: fixed; left: 50%; transform: translateX(-50%) translateY(20px);\n      bottom: 20px; background: #111; color: #fff; padding: 10px 16px;\n      border-radius: 10px; opacity: 0; pointer-events: none; transition: opacity .25s, transform .25s;\n      z-index: 9999;\n    }\n    .mb-toast--success { background: #16a34a; }\n    .mb-toast--error { background: #dc2626; }\n    .mb-toast.is-visible { opacity: 1; transform: translateX(-50%) translateY(0); }\n    @media (prefers-color-scheme: light) {\n      .card { background: #f3f4f6; }\n    }\n  ',document.head.appendChild(e)}(),await a(),i()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",c):c()})();
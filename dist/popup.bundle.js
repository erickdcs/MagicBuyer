(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{idAbActiveTransfers:()=>Ne,idAbAddBuyDelay:()=>te,idAbAddFilterGK:()=>ie,idAbAvailableItems:()=>Fe,idAbBidExact:()=>O,idAbBidFutBin:()=>ft,idAbBuyPrice:()=>N,idAbCardCount:()=>R,idAbCloseTabToggle:()=>se,idAbCoins:()=>Ie,idAbCountDown:()=>yt,idAbCustomDiscordNameNotificationToggle:()=>re,idAbCycleAmount:()=>q,idAbDelayToAdd:()=>ne,idAbDontMoveWon:()=>gt,idAbDownloadFilter:()=>Qe,idAbDownloadStats:()=>vt,idAbFiltersFileToUpload:()=>at,idAbFiltersToUpload:()=>Ze,idAbIgnoreAllowToggle:()=>dt,idAbItemExpiring:()=>L,idAbMaxBid:()=>U,idAbMaxPurchases:()=>xt,idAbMaxRating:()=>Y,idAbMaxSearchPage:()=>ee,idAbMessageNotificationToggle:()=>oe,idAbMinDeleteCount:()=>V,idAbMinRating:()=>z,idAbNumberFilterSearch:()=>Re,idAbOverSearchWarning:()=>Mt,idAbPauseFor:()=>j,idAbProfit:()=>et,idAbRandMinBidInput:()=>X,idAbRandMinBidToggle:()=>Z,idAbRandMinBuyInput:()=>K,idAbRandMinBuyToggle:()=>Q,idAbReportProblem:()=>ht,idAbRequestCount:()=>Pe,idAbResumeAfterErrorOccured:()=>bt,idAbSearchProgress:()=>_e,idAbSearchResult:()=>k,idAbSellPrice:()=>W,idAbSellToggle:()=>H,idAbSendListingNotificationToggle:()=>ae,idAbShouldSort:()=>At,idAbSoldItems:()=>Ee,idAbSolveCaptcha:()=>Ce,idAbSortBy:()=>wt,idAbSortOrder:()=>St,idAbSoundToggle:()=>le,idAbStatisticsProgress:()=>Be,idAbStatus:()=>xe,idAbStopAfter:()=>J,idAbStopErrorCode:()=>Ue,idAbStopErrorCodeCount:()=>ke,idAbToggleRunner:()=>mt,idAbUnsoldItems:()=>De,idAbUploadBtn:()=>lt,idAbUploadFilter:()=>Ke,idAbUseFutWiz:()=>Et,idAbWaitTime:()=>G,idAddIgnorePlayers:()=>it,idAddIgnorePlayersList:()=>ot,idAntiCaptchKey:()=>qe,idAutoClearExpired:()=>ct,idAutoClearLog:()=>Je,idBtnActions:()=>$t,idBtnReport:()=>Ct,idBuyFutBinPercent:()=>pt,idBuyFutBinPrice:()=>ut,idCalcBinPrice:()=>we,idCapatchaMp3:()=>We,idClearLogButton:()=>ve,idDeleteFilter:()=>$e,idDiscordChannelId:()=>me,idDiscordToken:()=>pe,idFUTMarketAlertToken:()=>fe,idFilterDropdown:()=>E,idFilterDropdownHeader:()=>D,idFinishMp3:()=>Pt,idFutBinDuration:()=>rt,idInfoWrapper:()=>he,idLog:()=>It,idNotificationType:()=>ue,idPreserveChanges:()=>ye,idProgressAutobuyer:()=>ge,idProxyAddress:()=>Ve,idProxyLogin:()=>Ge,idProxyPassword:()=>je,idProxyPort:()=>He,idRemoveIgnorePlayers:()=>st,idRunFilterSequential:()=>nt,idSearchCancelButton:()=>be,idSearchWrapper:()=>Le,idSelectFilterCount:()=>Ae,idSelectedFilter:()=>F,idSellAfterTax:()=>Te,idSellCheckBuyPrice:()=>tt,idSellFutBinPercent:()=>Xe,idSellFutBinPrice:()=>Ye,idSellRatingThreshold:()=>ze,idSession:()=>_t,idTelegramBotToken:()=>ce,idTelegramChatId:()=>de,idTestNotification:()=>Se,idTooltip:()=>Tt,idWebHookUrl:()=>Bt,idWinCount:()=>Me,idWinMp3:()=>Oe});var n={};e.r(n),e.d(n,{R:()=>Ji,T:()=>zi});const i="Paused",s="Stopped",o={521:"Request Rejected",512:"Request Rejected",429:"Too many request from this user",426:"Other user won the (card / bid)",461:"Other user won the (card / bid)"},r={idBuyFutBinPercent:95,idAbCardCount:1e3,idAbCardCountisDefaultValue:!0,idAbItemExpiring:"1H",idAbItemExpiringisDefaultValue:!0,idAbSearchResult:21,idAbSearchResultisDefaultValue:!0,idSellFutBinPercent:"105-110",idFutBinDuration:"1H",idFutBinDurationisDefaultValue:!0,idAbMinDeleteCount:10,idSellRatingThreshold:100,idSellRatingThresholdisDefaultValue:!0,idAbMinRating:10,idAbMinRatingisDefaultValue:!0,idAbMaxRating:100,idAbMaxRatingisDefaultValue:!0,idAbMaxSearchPage:5,idAbMaxSearchPageisDefaultValue:!0,idAbRandMinBidInput:300,idAbRandMinBidInputisDefaultValue:!0,idAbRandMinBuyInput:300,idAbRandMinBuyInputisDefaultValue:!0,idBuyFutBinPrice:!0,idSellFutBinPrice:!0,idSellCheckBuyPrice:!0,idAbSellToggle:!1,idAbRandMinBidToggle:!0},a={idAbAddBuyDelay:!0,idAbCycleAmount:"15-20",idAbDelayToAdd:"3S",idAbMaxPurchases:1,idAbNumberFilterSearch:3,idAbNumberFilterSearchisDefaultValue:!0,idAbPauseFor:"15-30S",idAbSoundToggle:!0,idAbStopAfter:"1-2H",idAbStopErrorCodeCount:3,idAbWaitTime:"5-8",idAbWaitTimeisDefaultValue:!1,idAutoClearExpired:!0,idAutoClearLog:!0},l=!!window.ReactNativeWebView,c=new Map,d=(e,t)=>{c.set(e,t)},u=e=>{const t=c.get(e);return t&&t.expiryTimeStamp&&t.expiryTimeStamp<Date.now()?(c.delete(e),null):t},p=(e=!1)=>{const t=u("BuyerSettings")||{};if(e)return t;const n=u("CommonSettings")||{};return Object.assign({},t,n)},m=e=>{let t=u(e)||0;return t++,d(e,t),t},f=()=>((u("CommonSettings")||{}).idAbUseFutWiz?"futwiz":"futbin").toUpperCase(),g=e=>{let t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var i=0;i<e;i++)t+=n.charAt(Math.floor(62*Math.random()));return t},b=async(e=1)=>{const t=Math.floor(Math.random());await new Promise(n=>setTimeout(n,1e3*(t+e)))},h=(e,t)=>{window.ReactNativeWebView.postMessage(JSON.stringify({type:"downloadFile",payload:{data:JSON.stringify(e,null,4),fileName:t}}))},y=(e,t)=>{window.ReactNativeWebView.postMessage(JSON.stringify({type:"downloadFile",payload:{data:e,fileName:t}}))},v=(e,t)=>{const n="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e,null,4)),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download",`${t}.json`),document.body.appendChild(i),i.click(),document.body.removeChild(i)},w=(e,t)=>{const n="data:text/csv;charset=utf-8,%EF%BB%BF"+encodeURIComponent(e),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download",`${t}.csv`),document.body.appendChild(i),i.click(),document.body.removeChild(i)},S=e=>{if(e){let t=(e+="")[e.length-1].toUpperCase(),n=C(e.substring(0,e.length-1))/1e3;return n&&(n*="M"===t?60:"H"===t?3600:1),n}return 0},A=e=>{const t=B(e);return t.length>=2?_(t[0],t[1]):t[0]||0},C=e=>{if(e){const[t,n]=e.split("-").map(e=>parseInt(e));return 1e3*Math.round(Math.random()*(n-t)+t)}return 0},T=e=>{if(e){let t=e[e.length-1].toUpperCase(),n=parseInt(e.substring(0,e.length-1));return n&&(n*="M"===t?60:"H"===t?3600:1),n}return 0},_=(e,t)=>Math.round(Math.random()*(t-e)+e),B=e=>e?(e+"").split("-").map(e=>parseInt(e)):[],P=(e,t)=>(e.length<=t&&(e+=" ".repeat(t-e.length)),e),I=function(e){const t=p();if(!l&&t.idAbSoundToggle){let t=document.getElementById(Oe);"capatcha"==e?t=document.getElementById(We):"finish"==e?t=document.getElementById(Pt):"cardWon"==e&&(t=document.getElementById(Oe)),t.currentTime=0,t.play()}},M=function(e){if(!e)return 0;var t=(new Date).getTime();return Math.max(0,e.end-t)/(e.end-e.start)*100},x=function(e){for(let n of Object.keys(e)){const i=e[n];if(e[n+"isDefaultValue"])continue;const s=`#${t[n]}`;if("boolean"==typeof i){if(i){$(s).addClass("toggled");continue}$(s).removeClass("toggled")}else $(s).val(i)}},E="elem_"+g(15),D="elem_"+g(15),F="elem_"+g(15),N="elem_"+g(15),R="elem_"+g(15),U="elem_"+g(15),k="elem_"+g(15),L="elem_"+g(15),O="elem_"+g(15),W="elem_"+g(15),V="elem_"+g(15),H="elem_"+g(15),G="elem_"+g(15),q="elem_"+g(15),j="elem_"+g(15),J="elem_"+g(15),z="elem_"+g(15),Y="elem_"+g(15),X="elem_"+g(15),K="elem_"+g(15),Q="elem_"+g(15),Z="elem_"+g(15),ee="elem_"+g(15),te="elem_"+g(15),ne="elem_"+g(15),ie="elem_"+g(15),se="elem_"+g(15),oe="elem_"+g(15),re="elem_"+g(15),ae="elem_"+g(15),le="elem_"+g(15),ce="elem_"+g(15),de="elem_"+g(15),ue="elem_"+g(15),pe="elem_"+g(15),me="elem_"+g(15),fe="elem_"+g(15),ge="elem_"+g(15),be="elem_"+g(15),he="elem_"+g(15),ye="elem_"+g(15),ve="elem_"+g(15),we="elem_"+g(15),Se="elem_"+g(15),Ae="elem_"+g(15),$e="elem_"+g(15),Ce="elem_"+g(15),Te="elem_"+g(15),_e="elem_"+g(15),Be="elem_"+g(15),Pe="elem_"+g(15),Ie="elem_"+g(15),Me="elem_"+g(15),xe="elem_"+g(15),Ee="elem_"+g(15),De="elem_"+g(15),Fe="elem_"+g(15),Ne="elem_"+g(15),Re="elem_"+g(15),Ue="elem_"+g(15),ke="elem_"+g(15),Le="elem_"+g(15),Oe="elem_"+g(15),We="elem_"+g(15),Ve="elem_"+g(15),He="elem_"+g(15),Ge="elem_"+g(15),qe="elem_"+g(15),je="elem_"+g(15),Je="elem_"+g(15),ze="elem_"+g(15),Ye="elem_"+g(15),Xe="elem_"+g(15),Ke="elem_"+g(15),Qe="elem_"+g(15),Ze="elem_"+g(15),et="elem_"+g(15),tt="elem_"+g(15),nt="elem_"+g(15),it="elem_"+g(15),st="elem_"+g(15),ot="elem_"+g(15),rt="elem_"+g(15),at="elem_"+g(15),lt="elem_"+g(15),ct="elem_"+g(15),dt="elem_"+g(15),ut="elem_"+g(15),pt="elem_"+g(15),mt="elem_"+g(15),ft="elem_"+g(15),gt="elem_"+g(15),bt="elem_"+g(15),ht="elem_"+g(15),yt="elem_"+g(15),vt="elem_"+g(15),wt="elem_"+g(15),St="elem_"+g(15),At="elem_"+g(15),$t="elem_"+g(15),Ct="elem_"+g(15),Tt="elem_"+g(15),_t=g(15),Bt="elem_"+g(15),Pt="elem_"+g(15),It="elem_"+g(15),Mt="elem_"+g(15),xt="elem_"+g(15),Et="elem_"+g(15);d("sessionStats",{soldItems:"-",unsoldItems:"-",activeTransfers:"-",availableItems:"-",coins:"-",winCount:0,coinsNumber:0,previousPause:0,searchCount:0,profit:0,transactions:[],searchPerMinuteCount:0});const Dt=()=>{const e=M(u("searchInterval")),t=u("sessionStats");$("#"+Pe).html(t.searchCount),$("#"+et).html(t.profit),$("#"+Ie).html(t.coins),$("#"+Me).html(t.winCount),$("#"+_e).css("width",e),Nt()},Ft=()=>{const e=M(u("searchInterval")),t=u("sessionStats");$("#"+_e).css("width",e),$("#"+Be).css("width",e),$("#"+Ie).html(t.coins),$("#"+Me).html(t.winCount),$("#"+Pe).html(t.searchCount),$("#"+Ee).html(t.soldItems),$("#"+De).html(t.unsoldItems),$("#"+Fe).html(t.availableItems),$("#"+Ne).html(t.activeTransfers),$("#"+et).html(t.profit),Nt(),t.unsoldItems?$("#"+De).css("color","red"):$("#"+De).css("color",""),t.availableItems?$("#"+Fe).css("color","orange"):$("#"+Fe).css("color","")},Nt=()=>{const e=u("botStartTime");if(e&&u("autoBuyerActive")){const t=Math.abs(new Date-e)/1e3,n=Math.floor(t/60/60%24),i=Math.floor(t/60%60),s=Math.floor(t%60),o=(n<10?"0":"")+n+":"+(i<10?"0":"")+i+":"+(s<10?"0":"")+s;$("#"+yt).html(o),Rt("runningTime",o)}},Rt=(e,t)=>{const n=u("sessionStats");n[e]=t,d("sessionStats",n)},Ut=e=>u("sessionStats")[e]||0,kt=function(e,t,n){const i=new UTStandardButtonControl;if(i.init(),i.addTarget(i,t,EventType.TAP),i.setText(e),n){const e=n.split(" ");for(let t of e)i.getRootElement().classList.add(t)}return i},Lt=()=>{const e=$(`<div style=${isPhone()?"height: 90%;display: flex;flex-direction: column;padding: 7px;":"width:48%"} id=${It}>\n            <div class="logs-container">\n              <div data-title="Clear logs" class="button-clear">\n              </div>\n            </div>\n            <br/>\n            <div class="logWrapper">\n            <ul wrap="off"  style="height: 100%;overflow-x: auto;resize: none; width: 100%;" id=${ge} class="autoBuyerLog"></ul>\n            <br/>\n        </div>`);return e.find(".button-clear").append(kt("⎚",()=>ni()).__root),e},Ot=()=>{$("#"+ge).empty()};let Wt=new Set;const Vt=(e,t,n,i,s=!1)=>{const o=u(t)||{};"number"===i&&(n=parseInt(n)),o[e]=n||null,o[e+"isDefaultValue"]=s,d(t,o)},Ht=(e,t,n,i,s,o="number",r=".*",a="buyer-settings-field",l=null)=>{const c=Object.keys(n)[0];return t&&(l&&l(t),Vt(c,s,t,o,!0)),Wt.has(c)||($(document).on("input",`#${n[c]}`,({target:{value:e}})=>{l&&l(e),Vt(c,s,e||t,o,!e)}),Wt.add(c)),`<div class="price-filter ${a}">\n       <div class="info">\n           <span class="secondary label">${e} :<br/><small>${i}</small></span>\n       </div>\n       <div class="buttonInfo">\n           <div class="inputBox">\n               <input pattern="${r}" type="${o}" class="numericInput" id='${n[c]}' placeholder=${t}>\n           </div>\n       </div>\n    </div>`};let Gt=new Set;const qt=(e,t,n,i,s="buyer-settings-field",o=null)=>{const r=Object.keys(t)[0];return Gt.has(r)||($(document).on("click touchend",`#${t[r]}`,e=>{!o&&((e,t,n)=>{const i=u(t)||{};i[e]?(i[e]=!1,$(n.currentTarget).removeClass("toggled")):(i[e]=!0,$(n.currentTarget).addClass("toggled")),d(t,i)})(r,i,e),o&&o(e)}),Gt.add(r)),`\n    <div class="price-filter  ${s}">\n        <div class="ut-toggle-cell-view">\n           <span class="ut-toggle-cell-view--label">${e} <br/><small>${n}</small></span>\n             <div id='${t[r]}' class="ut-toggle-control">\n               <div class="ut-toggle-control--track">\n              </div>\n              <div class= "ut-toggle-control--grip" >\n          </div> \n           </div> \n       </div>\n    </div> `},jt=function(){const e=f();return`<div class='buyer-settings-wrapper buy-settings-view'>\n      ${qt("Find Buy Price",{idBuyFutBinPrice:ut},`(Uses ${e} price for Buy)`,"BuyerSettings")}\n      ${Ht("Buy/Bid Price Percent",100,{idBuyFutBinPercent:pt},`(Buy/Bid Price percent of ${e} Price)`,"BuyerSettings")}\n      ${qt(`Bid For ${e} Price`,{idAbBidFutBin:ft},`(Bid if the current bid is lesser than ${e} Price)`,"BuyerSettings")}\n      ${Ht("Buy Price","",{idAbBuyPrice:N},"<br/>","BuyerSettings")}\n      ${Ht("No. of cards to buy",1e3,{idAbCardCount:R},"(Works only with Buy price)","BuyerSettings")}\n      ${Ht("Bid Price","",{idAbMaxBid:U},"<br/>","BuyerSettings")}\n      ${Ht("Bid items expiring in","1H",{idAbItemExpiring:L},"(S for seconds, M for Minutes, H for hours)","BuyerSettings","text","\\d+[H|M|S|h|m|s]$")} \n      ${Ht("Search result threshold",21,{idAbSearchResult:k},"(Buy or bid cards only if the no.of search results is lesser than the specified value)","BuyerSettings")}\n      ${qt("Bid Exact Price",{idAbBidExact:O},"","BuyerSettings")}      \n     </div>\n    `};$(document).on("keyup","#"+W,function({target:{value:e}}){Jt(e)});const Jt=e=>{const t=parseInt(e);if(isNaN(t))return void $("#"+Te).html(0);const n=(e-e/100*5).toLocaleString();$("#"+Te).html(n)},zt=function(){const e=f();return`<div style='display : none' class='buyer-settings-wrapper sell-settings-view'>\n  ${qt("Find Sale Price",{idSellFutBinPrice:Ye},`(Uses ${e} price for listing)`,"BuyerSettings")}\n  ${Ht("Sell Price Percent","100-100",{idSellFutBinPercent:Xe},`(Sale Price percent of ${e} Price)`,"BuyerSettings","text","\\d+-\\d+$")}\n  ${qt("Check buy price before listing",{idSellCheckBuyPrice:tt},"(List only if Buy Price is lesser than Sale Price)","BuyerSettings")}\n  ${Ht("Sell Price","",{idAbSellPrice:W},`(-1 to send to transferlist)<br />Receive After Tax: <span id=${Te}>0</span>`,"BuyerSettings")} \n   ${Ht("List Duration","1H",{idFutBinDuration:rt},"List Duration when listing","BuyerSettings","text","\\d+[H|M|S|h|m|s]$")}\n  ${Ht("Clear sold count",10,{idAbMinDeleteCount:V},"(Clear sold items when reach a specified count)","BuyerSettings")}\n  ${Ht("Rating Threshold",100,{idSellRatingThreshold:ze},"(Rating threshold to list the sniped player)","BuyerSettings")}\n  ${qt("Relist Unsold Items",{idAbSellToggle:H},"","BuyerSettings")}\n  ${qt("Dont move won items",{idAbDontMoveWon:gt},"(Keep won items in Unassigned or Transfer Targets)","BuyerSettings")}\n  </div>`},Yt=function(){return`<div style='display : none' class='buyer-settings-wrapper safety-settings-view'>\n  ${Ht("Wait Time","7-15",{idAbWaitTime:G},"(Random second range eg. 7-15)","CommonSettings","text","\\d+-\\d+$")}\n  ${Ht("Max purchases per search request",1,{idAbMaxPurchases:xt},"Increase this, only if you are Adding Delay After Buy of alteast 3S","CommonSettings")}\n  ${Ht("Pause Cycle","10-15",{idAbCycleAmount:q},"(No. of searches performed before triggering Pause eg. 10-15)","CommonSettings","text","\\d+-\\d+$")}\n  ${Ht("Pause For","5-8S",{idAbPauseFor:j},"(S for seconds, M for Minutes, H for hours eg. 0-0S)","CommonSettings","text","\\d+-\\d+[H|M|S|h|m|s]$")}\n  ${qt("Add Delay After Buy",{idAbAddBuyDelay:te},"(Adds Delay after trying to buy / bid a card)","CommonSettings")}\n  ${Ht("Delay To Add","1S",{idAbDelayToAdd:ne},"(S for seconds, M for Minutes, H for hours)","CommonSettings","text","\\d+[H|M|S|h|m|s]$")}\n  ${Ht("Stop After","3-4H",{idAbStopAfter:J},"(S for seconds, M for Minutes, H for hours  eg. 3-4H)","CommonSettings","text","\\d+-\\d+[H|M|S|h|m|s]$")}\n  ${qt("Show Search Exceed Warning",{idAbOverSearchWarning:Mt},"(Shows a warning in log if number of search per minute exceeds 15)","CommonSettings")} \n  </div>`},Xt=function(){return`<div style='display : none' class='buyer-settings-wrapper captcha-settings-view'>\n    ${qt("Close Web App on Captcha Trigger",{idAbCloseTabToggle:se},"","CommonSettings")}         \n    ${qt("Auto Solve Captcha",{idAbSolveCaptcha:Ce},"","CommonSettings")}\n    ${Ht("Anti-Captcha Key","",{idAntiCaptchKey:qe},"","CommonSettings","text")}\n    ${Ht("Proxy Address","",{idProxyAddress:Ve},"","CommonSettings","text")}\n    ${Ht("Proxy Port","",{idProxyPort:He},"","CommonSettings")}\n    ${Ht("Proxy User Name (Optional)","",{idProxyLogin:Ge},"","CommonSettings","text")}\n    ${Ht("Proxy User Password (Optional)","",{idProxyPassword:je},"","CommonSettings","text")} \n    `};let Kt=new Set;const Qt=(e,t,n,i)=>(Kt.has(e)||(Zt(e,n),Kt.add(e)),`<button class="btn-standard ${i}" id="${e}">${t}</button>`),Zt=(e,t)=>{$(document).on({mouseenter:function(){$(this).addClass("hover")},mouseleave:function(){$(this).removeClass("hover")},click:function(){t()},touchenter:function(){$(this).addClass("hover")},touchleave:function(){$(this).removeClass("hover")},touchend:function(){t()}},`#${e}`)},en=function(){return`<div style='display : none' class='buyer-settings-wrapper notification-settings-view'> \n ${l?"":`${Ht("Telegram Bot Token","",{idTelegramBotToken:ce},"Token of your own bot","CommonSettings","text")}\n  ${Ht("Telegram Chat ID","",{idTelegramChatId:de},"Your Telegram ChatID","CommonSettings","text")}\n  ${Ht("Discord Bot Token","",{idDiscordToken:pe},"Your Discord Bot Token","CommonSettings","text")}\n  ${Ht("Discord Channel ID","",{idDiscordChannelId:me},"Your Discord Channel ID","CommonSettings","text")}\n  ${Ht("Discord WebHook Url","",{idWebHookUrl:Bt},"Your Discord Channel Webhook Url","CommonSettings","text")}\n  ${Ht("Fut Market Alert Notification Token","",{idFUTMarketAlertToken:fe},"Your FUT Market Alert App's Token","CommonSettings","text")}\n  ${qt("Send Listing Notification",{idAbSendListingNotificationToggle:ae},"","CommonSettings")}`}\n  ${Ht("Notification Type","",{idNotificationType:ue},"Type A for all notifications, B for buy or L for lost","CommonSettings","text","[A|B|L]$")}\n  ${qt("Send Notification",{idAbMessageNotificationToggle:oe},"","CommonSettings")}\n   ${l?"":`${qt("Sound Notification",{idAbSoundToggle:le},"","CommonSettings")}\n  <audio id='${Oe}' hidden>\n    <source src="https://notificationsounds.com/storage/sounds/file-sounds-869-coins.ogg" type="audio/ogg">\n    <source src="https://notificationsounds.com/storage/sounds/file-sounds-869-coins.mp3" type="audio/mpeg">\n      "Your browser does not support the audio element"\n  </audio>\n  <audio id='${We}' hidden>\n    <source src="https://notificationsounds.com/storage/sounds/file-sounds-897-alarm-frenzy.ogg" type="audio/ogg">\n    <source src="https://notificationsounds.com/storage/sounds/file-sounds-897-alarm-frenzy.mp3" type="audio/mpeg">\n      "Your browser does not support the audio element"\n  </audio>\n  <audio id='${Pt}' hidden>\n    <source src="https://freesound.org/data/previews/220/220763_4104696-lq.ogg" type="audio/ogg">\n    <source src="https://freesound.org/data/previews/220/220763_4104696-lq.mp3" type="audio/mpeg">\n      "Your browser does not support the audio element"\n  </audio> `}\n     ${qt("Use Custom Discord Webhook Name",{idAbCustomDiscordNameNotificationToggle:re},"","CommonSettings")}\n   <div class="btn-test-notification buyer-settings-field">\n   ${Qt(Se,"Test Notification",()=>Gn("Test Notification Message",!0,!0),"call-to-action")}\n   </div>\n  `},tn=function(){return`<div style='display : none' class='buyer-settings-wrapper common-settings-view'>\n  ${Ht("Error Codes to stop bot (csv)","",{idAbStopErrorCode:Ue},"(Eg. 412,421,521)","CommonSettings","text","^\\d+(,\\d+)*$")}\n  ${Ht("No. of times error code should occur",3,{idAbStopErrorCodeCount:ke},"<br />","CommonSettings")}\n  ${Ht("Resume bot after","",{idAbResumeAfterErrorOccured:bt},"(S for seconds, M for Minutes, H for hours eg. 0-0S)","CommonSettings","text","\\d+-\\d+[H|M|S|h|m|s]$")}\n  ${qt("Auto Clear Log",{idAutoClearLog:Je},"(Automatically clear logs every 2 minutes)","CommonSettings")}\n  ${qt("Auto Clear Expired Items",{idAutoClearExpired:ct},"(Automatically clear expired items from transfer targets)","CommonSettings")}\n  ${qt("Use Futwiz Price",{idAbUseFutWiz:Et},"(Uses Futwiz price for buying/selling cards)","CommonSettings")}\n  </div>`},nn=function(e,t){let n=!1;return $(`${e} option`).each(function(){if(this.value===t)return n=!0,!1}),n||$(e).append($("<option></option>").attr("value",t).text(t)),n},sn=function(){const e=$(`#${F}`).val()||[];e.length?d("selectedFilters",e):d("selectedFilters",[])};let on;$(document).on({change:()=>{const e=$(`#${wt}`).val()||"buy",t=u("BuyerSettings")||{};t.idAbSortBy=e,d("BuyerSettings",t)}},`#${wt}`);const rn=function(){if("function"!=typeof UTPlayerSearchControl)return $('<div class="price-filter buyer-settings-field">\n        <div class="info">\n          <span class="secondary label">\n            Players List :<br/>\n            <small>Player search is unavailable. Open the MagicBuyer tab in the web app first.</small>\n          </span>\n        </div>\n      </div>');on=new UTPlayerSearchControl;const e=`#${ot}`,t=$(`\n            <div class="price-filter buyer-settings-field">\n              <div class="info">\n               <span class="secondary label">\n                  <button id=${Tt} style="font-size:16px" class="flat camel-case">Players List</button><br/>\n                </span>\n              </div>\n              <div class="ignore-players displayCenterFlx">\n                ${Qt(it,"+",()=>{const t=`${on._playerNameInput.value}(${on.selected.rating})`,n=nn(e,t);if($(`${e} option[value="${t}"]`).attr("selected",!0),!n){const e=u("BuyerSettings")||{},n=e.idAddIgnorePlayersList||[];n.push({id:on.selected.id,displayName:t}),e.idAddIgnorePlayersList=n,d("BuyerSettings",e)}},"btn-standard filterSync action-icons")}                \n                </div>\n              </div>\n              <div class="price-filter buyer-settings-field">\n                <div class="info">\n                <span class="secondary label">\n                  <button id=${Tt} style="font-size:16px" class="flat camel-case">Remove from Players List</button><br/>\n                </span>\n                </div>\n                <div class="displayCenterFlx">\n                  <select style="width:90%;height: 3rem;font-size: 1.5rem;" class="filter-header-settings" id=${ot}>\n                    <option selected="true" disabled>Players List</option>                            \n                  </select>\n                  ${Qt(st,"❌",()=>{const t=$(`${e} option`).filter(":selected").val();if("Ignored Players List"!=t){$(`${e} option[value="${t}"]`).remove(),$(`${e}`).prop("selectedIndex",0);const n=u("BuyerSettings")||{};let i=n.idAddIgnorePlayersList||[];i=i.filter(({displayName:e})=>e!=t),n.idAddIgnorePlayersList=i,d("BuyerSettings",n)}},"btn-standard filterSync font15 action-icons")}\n                </div>\n              </div>              \n              `);return on&&($(on.__root).insertBefore(t.find(`#${it}`)),on.init(),on._playerNameInput.setPlaceholder("Search Players")),t},an=function(){const e=$(`<div style='display : none' class='buyer-settings-wrapper results-filter-view'>\n    <div class="place-holder">\n    </div>\n    ${qt("Ignore/Buy Players List",{idAbIgnoreAllowToggle:dt},"(If toggled bot will only buy/bid the above players else bot will ignore the players when bidding/buying )","BuyerSettings")}\n    ${Ht("Min Rating",10,{idAbMinRating:z},"Minimum Player Rating","BuyerSettings")}\n    ${Ht("Max Rating",100,{idAbMaxRating:Y},"Maximum Player Rating","BuyerSettings")}    \n    ${Ht("Search result page limit",5,{idAbMaxSearchPage:ee},"No of. pages bot should move forward before going back to page 1","BuyerSettings")}\n    ${Ht("Max value of random min bid",300,{idAbRandMinBidInput:X},"","BuyerSettings")}\n    ${qt("Use random min bid",{idAbRandMinBidToggle:Z},"","BuyerSettings")}\n    ${Ht("Max value of random min buy",300,{idAbRandMinBuyInput:K},"","BuyerSettings")}\n    ${qt("Use random min buy",{idAbRandMinBuyToggle:Q},"","BuyerSettings")}\n    ${qt("SKIP GK",{idAbAddFilterGK:ie},"(Skip all goalkeepers to buy / bid a card)","BuyerSettings")}\n    ${qt("Sort players",{idAbShouldSort:At},"","BuyerSettings")}\n    <div class="price-filter buyer-settings-field">\n      <div class="displayCenterFlx">\n      <select style="width:95%;height: 3rem;font-size: 1.5rem;" class="select-sortBy filter-header-settings" id="${wt}">\n        <option disabled selected>--Select Sort Attribute--</option>\n        <option value="expires">Expires on</option>          \n        <option value="buy">Buy now price</option>\n        <option value="bid">Bid now price</option>\n        <option value="rating">Player rating</option>\n      </select>\n      </div>\n    </div>\n    ${qt("Order",{idAbSortOrder:St},"(Enabled = descending, Disabled = ascending)","BuyerSettings")}\n  </div>`),t=e.find(".place-holder");return rn().insertAfter(t),e};let ln;const cn=e=>new Promise((t,n)=>{const i=ln.transaction("Filters","readwrite");i.objectStore("Filters").delete(e),i.oncomplete=function(){t()},i.onerror=function(){n()}}),dn=(e,t,n="Filters")=>new Promise((i,s)=>{const o=ln.transaction(n,"readwrite");o.objectStore(n).put({filterName:e,jsonData:t}),o.oncomplete=function(){i()},o.onerror=function(){s()}}),un=(e="Filters")=>new Promise((t,n)=>{const i=ln.transaction(e,"readonly").objectStore(e).getAll();i.onsuccess=function(){const e={};if(i.result.length)for(let t=0;t<i.result.length;t++)e[i.result[t].filterName]=i.result[t].jsonData;t(e)},i.onerror=function(){n()}}),pn=(e="Filters")=>un(e),mn=(e,t,n="Filters")=>dn(e,t,n),fn=(e,t,n,i)=>{const s=new EADialogViewController({dialogOptions:e,message:n,title:t});s.init(),s.onExit.observe(void 0,function(e,t){e.unobserve(this),i.call(this,t)}),gPopupClickShield.setActivePopup(s)};$(document).on({touchend:function(){$(`#${at}`).trigger("click")}},`#${at}`);const gn=e=>{const t={},n=$(`#${Ze}`).val()||[];if(n.length){for(let i of n){const n=e[i],s=JSON.parse(n);t[i]=s}var i,s;i={filters:t},s="filters",l?h(i,s):v(i,s),Vn("Filters downloaded successfully")}else Vn("No filter selected",UINotificationType.NEGATIVE)},bn=()=>{const e=$(`#${at}`).prop("files");if(!e||!e[0])return void Vn("No filter file selected",UINotificationType.NEGATIVE);const t=e[0],n=new FileReader;n.onload=e=>{const t=JSON.parse(e.target.result);if(t&&t.filters){for(let e in t.filters)kn(e,t.filters[e]);Vn("Filters uploaded successfully")}else Vn("Not a valid filters file")},n.readAsText(t)},hn=async()=>{u("filters")||d("filters",await pn()||{});let e=u("filters");return e=Object.keys(e).sort().reduce((t,n)=>(t[n]=e[n],t),{}),e},yn=async()=>Object.keys(await hn());$(document).on({change:sn,click:sn,touchend:sn},`#${F}`);const vn=(e,t)=>{let n=u(t);return n?(n=!1,$(e.currentTarget).removeClass("toggled")):(n=!0,$(e.currentTarget).addClass("toggled")),d(t,n),n},wn=async function(){return u("runSequentially")&&(d("runSequentially",!1),setTimeout(()=>{$(`#${nt}`).click()})),`<div style='display : none' class='buyer-settings-wrapper filter-settings-view'>\n                <div class="price-filter buyer-settings-field multiple-filter teleporter">\n                    <select  multiple="multiple" class="multiselect-filter filter-header-settings" id="${F}"\n                     name="selectedFilters" style="overflow-y : scroll;">\n                     ${Object.keys(await hn()).map(e=>`<option value='${e}'>${e}</option>`)}\n                    </select>\n                </div>\n                ${Ht("No. of search For each filter",u("fiterSearchCount")||3,{idAbNumberFilterSearch:Re},"(Count of searches performed before switching to another filter)","CommonSettings","number",null,"buyer-settings-field",e=>d("fiterSearchCount",parseInt(e)||3))}\n                ${qt("Switch filter sequentially",{idRunFilterSequential:nt},"","CommonSettings","buyer-settings-field",e=>vn(e,"runSequentially"))}\n            </div>\n    `},Sn=async function(e){const t=this,n=e?"transfer":"";$(document).off("change",`#${E}${n}`),$(document).on({change:function(){const i=$(`#${E}${n} option`).filter(":selected").val();Ln.call(t,i,e)}},`#${E}${n}`);const i=$(`<div style="width:100%;display: flex;flex-direction: column;">\n            ${isPhone()&&!e?qt("Runner Mode",{idAbToggleRunner:mt},"","MisSettings","runner",e=>{const t=vn(e,"runnerToggle");$(".auto-buyer").toggleClass("displayNone"),t?$(".filter-place").append($(`#${F}`)):$(".teleporter").append($(`#${F}`))}):""}\n            ${e?"":`<div id=${Ct} class="btn-report"></div>`}         \n            <div class="price-filter buyer-settings-field multiple-filter filter-place">\n            </div> \n            <div class="button-container btn-filters">\n                 <select class="filter-header-settings" id='${E}${n}'>\n                    <option selected="true" disabled>Choose filter to load</option>\n                    ${e?"":'<option value="_default">_DEFAULT</option>'}  \n                    ${Object.keys(await hn()).map(e=>`<option value="${e}">${e}</option>`)}                    \n                 </select>                 \n                ${e?"":Qt(Ke,"⇧",()=>{(()=>{let e=`Upload Filter Json file <br /> <br />\n  <input accept=".json" type="file" id="${at}">\n   </input> <br /> <br /> <br />\n   Uploading filters will override filters with the same name`;fn([{labelEnum:enums.UIDialogOptions.OK},{labelEnum:enums.UIDialogOptions.CANCEL}],"Upload filters",e,e=>{2===e&&bn()})})()},"filterSync")}\n               ${e?"":Qt(Qe,"⇩",()=>{(()=>{const e=u("filters");let t=`Choose filters to Download <br /> <br />\n  <select  multiple="multiple" class="multiselect-filter filter-header-settings" id="${Ze}"\n      style="overflow-y : scroll">\n      ${Object.keys(e).map(e=>`<option value='${e}'>${e}</option>`)}\n   </select> <br /> <br /> <br />`;fn([{labelEnum:enums.UIDialogOptions.OK},{labelEnum:enums.UIDialogOptions.CANCEL}],"Download filters",t,async t=>{2===t&&await gn(e)})})()},"filterSync")}\n             </div> \n               ${e?"":`<div id=${$t} style="margin-top: 1%;" class="button-container btn-filters"></div>`}\n             </div>`);return!e&&An.call(this,i,t),i},An=function(e,t){const n=e.find(`#${$t}`),i=e.find(`#${Ct}`);n.append(kt("Delete Filter",()=>On.call(t),"call-to-action btn-delete-filter").__root),n.append(kt("Save Filter",function(){Un.call(this,t)},"call-to-action btn-save-filter").__root),i.append(kt("Report a problem",()=>{fn([{labelEnum:atob("RGlzY29yZA==")},{labelEnum:atob("VHdpdHRlcg==")},{labelEnum:atob("R2l0aHVi")}],atob("UmVwb3J0IGEgcHJvYmxlbQ=="),atob("QmVsb3cgYXJlIHRoZSBsaXN0IG9mIHdheXMgdG8gcmVwb3J0IGEgcHJvYmxlbSA8YnIgLz5NYWtlIHN1cmUgdG8gZ28gdGhyb3VnaCB0aGUgPGEgaHJlZj0naHR0cHM6Ly95b3V0dWJlLmNvbS9wbGF5bGlzdD9saXN0PVBMR21LTWczYVJrWGpQUjVna2x4TXlxeHRoWW9vV0k1SUMnIHRhcmdldD0nX2JsYW5rJz55b3V0dWJlIHBsYXlsaXN0PC9hPiBpZiBhbnkgc2V0dGluZ3MgYXJlIHVuY2xlYXIgPGJyIC8+"),e=>{e===atob("R2l0aHVi")?window.open(atob("aHR0cHM6Ly9naXRodWIuY29tL2NoaXRoYWt1bWFyMTMvRlVULUF1dG8tQnV5ZXIvaXNzdWVz"),atob("X2JsYW5r")):e===atob("RGlzY29yZA==")?window.open(atob("aHR0cHM6Ly9kaXNjb3JkLmNvbS9pbnZpdGUvY2t0SFltcA=="),atob("X2JsYW5r")):e===atob("VHdpdHRlcg==")&&window.open(atob("aHR0cHM6Ly90d2l0dGVyLmNvbS9BbGdvc0Nr"),atob("X2JsYW5r"))})},"call-to-action").__root)},$n=new Map;let Cn,Tn;$n.set(0,{label:"Buy/Bid Settings",selector:".buy-settings-view"}),$n.set(1,{label:"Sell Settings",selector:".sell-settings-view"}),$n.set(2,{label:"Search Settings",selector:".results-filter-view"}),$n.set(3,{label:"Safety Settings",selector:".safety-settings-view"}),$n.set(4,{label:"Filter Settings",selector:".filter-settings-view"}),$n.set(5,{label:"Captcha Settings",selector:".captcha-settings-view"}),$n.set(6,{label:"Notification Settings",selector:".notification-settings-view"}),$n.set(7,{label:"Common Settings",selector:".common-settings-view"});const _n=function(){return Tn=new EAFilterBarView,$n.forEach((e,t)=>{Tn.addTab(t,e.label)}),Tn.setActiveTab(0),Tn.layoutSubviews(),d("activeSettingsTab",0),Tn.addTarget(this,xn,EventType.TAP),Tn.__root.style="margin-top: 20px;",Cn=$(Tn.__root),Cn.find(".menu-container").css("overflow-x","auto"),In(!0),Tn},Bn=async function(){Mn(),Dn(),await In();const e=u("AutoBuyerInstance");UTMarketSearchFiltersViewController.prototype._eResetSelected.call(e)},Pn=async e=>{let t=await pn("CommonSettings");if(t=JSON.parse(t.CommonSettings||"{}"),!$.isEmptyObject(t)){const n=e?u("CommonSettings"):{};d("CommonSettings",Object.assign({},n,t))}},In=async function(e){Tn.setActiveTab(0),d("activeSettingsTab",0),Cn.append(jt.call(this)),Cn.append(zt.call(this)),Cn.append(an.call(this)),Cn.append(Yt.call(this));const t=await wn.call(this);Cn.append(t),Cn.append(Xt.call(this)),Cn.append(en.call(this)),Cn.append(tn.call(this)),$(".menu-container").animate({scrollLeft:0}),setTimeout(async()=>{const t=u("selectedFilters")||[],{idAbSortBy:n}=u("BuyerSettings")||{};n&&$(`${wt} option[value='${n}']`).prop("selected","selected"),$.each(t,function(e,t){$(".multiselect-filter option[value='"+t+"']").prop("selected","selected")}),e&&await Pn()})},Mn=()=>{$n.forEach((e,t)=>{$(e.selector).remove()}),on&&"function"==typeof on.destroy&&on.destroy(),on=null},xn=function(e,t,n){En(),d("activeSettingsTab",n.index);const i=$n.get(n.index).selector;$(i).css("display","")},En=()=>{$n.forEach((e,t)=>{$(e.selector).css("display","none")})},Dn=()=>{d("currentFilter",null),d("BuyerSettings",{}),d("currentFilter",{})},Fn=()=>{document.querySelectorAll(":invalid").length&&Vn("Settings with invalid value found, fix these values for autobuyer to work as intended",UINotificationType.NEGATIVE)},Nn=`#${E}`,Rn=`#${F}`,Un=function(e){const t=this;$(t).addClass("active");let n=p(!0),i=u("CommonSettings");setTimeout(function(){let s={};const o=e._viewmodel;s.searchCriteria={criteria:o.searchCriteria,playerData:o.playerData,buyerSettings:n};let r=$(`${Nn} option`).filter(":selected").val();"Choose filter to load"===r&&(r=void 0);let a=prompt("Enter a name for this filter",r);if(Fn(),a){if("_DEFAULT"===a.toLocaleUpperCase())return Vn("Cannot override _DEFAULT filter",UINotificationType.NEGATIVE);kn(a,s),mn("CommonSettings",JSON.stringify(i),"CommonSettings"),d("currentFilter",a),$(t).removeClass("active"),Vn("Changes saved successfully")}else $(t).removeClass("active"),Vn("Filter Name Required",UINotificationType.NEGATIVE)},200)},kn=(e,t)=>{e=e.toUpperCase(),nn(Nn,e),nn(`#${F}`,e),$(`${Nn} option[value="${e}"]`).attr("selected",!0),u("filters")[e]=JSON.stringify(t),mn(e,u("filters")[e])},Ln=async function(e,t){if("_default"===e)return(()=>{d("BuyerSettings",Object.assign({},r)),d("CommonSettings",Object.assign({},a));const e=p();x(e)})(),!1;u("runnerToggle")||t||await Bn();const n=u("filters")[e];if(!n)return!1;let{searchCriteria:{criteria:i,playerData:s,buyerSettings:o}}=JSON.parse(n);if(this.viewmodel.resetSearch(),this.viewDidAppear(),this.viewmodel.playerData={},Object.assign(this.viewmodel.searchCriteria,i),Object.assign(this.viewmodel.playerData,s),$.isEmptyObject(this.viewmodel.playerData)&&(this.viewmodel.playerData=null),this.viewDidAppear(),t)return;await Pn();const l=u("CommonSettings")||{};if(d("BuyerSettings",o),d("currentFilter",e),o=Object.assign({},o,l),x(o),o.idAddIgnorePlayersList&&o.idAddIgnorePlayersList.length)for(let{displayName:e}of o.idAddIgnorePlayersList)nn(`#${ot}`,e);return Fn(),!0},On=async function(){const e=$(`${Nn} option`).filter(":selected").val();if("_DEFAULT"===e.toLocaleUpperCase())return Vn("Cannot delete _DEFAULT filter",UINotificationType.NEGATIVE);"Choose filter to load"!=e&&($(`${Nn} option[value="${e}"]`).remove(),$(`${Nn}`).prop("selectedIndex",0),await Bn(),this.viewDidAppear(),delete u("filters")[e],$(`${Rn} option[value="${e}"]`).remove(),sn(),(e=>{cn(e)})(e),Vn("Changes saved successfully"))};let Wn=null;const Vn=function(e,t){t=t||UINotificationType.POSITIVE,services.Notification.queue([e,t])},Hn=e=>{services.PIN.sendData(PINEventType.PAGE_VIEW,{type:PIN_PAGEVIEW_EVT_TYPE,pgid:e})},Gn=(e,t,n)=>{const i=p();(i.idAbMessageNotificationToggle||n)&&(l?qn(e):zn(i,t,e),n&&Vn("Test Notification Sent"))},qn=e=>{window.ReactNativeWebView.postMessage(JSON.stringify({type:"Notification",message:e}))},jn=(e,t,n)=>{let i={embeds:[{description:e,color:t?2555648:16711680,footer:{text:`Auto Buyer Alert - ${(new Date).toLocaleTimeString()}`,icon_url:"https://cdn.discordapp.com/icons/768336764447621122/9de9ea0a7c6239e2f2fbfbd716189e79.webp"}}],avatar_url:"https://cdn.discordapp.com/icons/768336764447621122/9de9ea0a7c6239e2f2fbfbd716189e79.webp",username:"Fut Market Alert"};return n&&delete i.username,i},Jn=e=>{const{embeds:[t]}=e;return(new Discord.RichEmbed).setColor(t.color).setDescription(t.description).setFooter(t.footer.text,t.footer.icon_url)},zn=(e,t,n)=>{const i=e.idTelegramBotToken,s=e.idTelegramChatId,o=e.idWebHookUrl,r=e.idDiscordChannelId,a=e.idFUTMarketAlertToken,l=e.idAbCustomDiscordNameNotificationToggle;Yn(i,s,n),Kn(r,t,n,l),Xn(o,t,n,l),Zn(a,n)},Yn=(e,t,n)=>{if(e&&t){const i=`https://api.telegram.org/bot${e}/sendMessage?chat_id=${t}&parse_mode=Markdown&text=${n}`,s=new XMLHttpRequest;s.open("GET",i,!0),s.send()}},Xn=(e,t,n,i)=>{e&&fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(jn(n,t,i))})},Kn=(e,t,n,i)=>{if(e)if(Wn){const s=Wn.channels.get(e);s&&s.send(Jn(jn(n,t,i)))}else Wn=Qn(()=>{setTimeout(()=>{if(Wn){const s=Wn.channels.get(e);s&&s.send(Jn(jn(n,t,i)))}},200)})},Qn=e=>{const t=p(),n=new Discord.Client;let i=t.idDiscordToken;if(!i)return null;try{n.login(i),n.on("ready",function(){e&&e()}),n.on("message",async function(e){if(e.author.id!=n.user.id)if(/start/i.test(e.content)){const t=u("AutoBuyerInstance");Ji.call(t),e.channel.send(Jn(jn("Bot started successfully",!0)))}else if(/stop/i.test(e.content))zi(),e.channel.send(Jn(jn("Bot stopped successfully",!0)));else if(/runfilter/i.test(e.content)){let t=e.content.split("-")[1];if(t){t=t.toUpperCase(),zi(),d("selectedFilters",[]);const n=u("AutoBuyerInstance");if(!await Ln.call(n,t))return void e.channel.send(Jn(jn(`unable to find filter${t}`,!1)));Ji.call(n),e.channel.send(Jn(jn(`${t} started successfully`,!0)))}else e.channel.send(Jn(jn("Unable to find filter name",!1)))}})}catch(e){}return n},Zn=(e,t)=>{e&&fetch("https://exp.host/--/api/v2/push/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([{to:`ExponentPushToken[${e}]`,title:t,body:t}])})},ei=function(e){Gn("Captcha, please solve the problem so that the bot can work again.",!1),e?window.location.href="about:blank":ti("[!!!] Autostopping bot since Captcha got triggered",ge)},ti=function(e,t,n,i){setTimeout(()=>{var s=$("#"+t);const o=$(`\n              <li class="cardPalyerLi">\n              <div class="cardPalyer" style="${"success"===i?"border: solid #10AC84;":"error"===i?"border: solid #EE5253;":"warning"===i?"border: solid #FF9F43;":"border: solid #2E86DE;"}">\n              ${n?`<img\n                  style="width:30%; padding-left: 15px;"\n                  src="https://www.ea.com/ea-sports-fc/ultimate-team/web-app/content/24B23FDE-7835-41C2-87A2-F453DFDB2E82/2024/fut/items/images/mobile/portraits/${n?._metaData?.id}.png"\n                />`:""}\n              \n              <div class="container">\n                <span class="contentContainer" >${e}</span>\n                <div class="typeContent" style="${"success"===i?"background: #10AC84;":"error"===i?"background: #EE5253;":"warning"===i?"background: #FF9F43;":"background: #2E86DE;"}">\n                  <span class="typeContentText">${"success"===i?"✓":"error"===i?"X":"warning"===i?"!":"↻"}</span>\n                </div>\n              </div>\n              </div>\n              </li>\n          `);s.append(o),s[0]&&s.scrollTop(s[0].scrollHeight)},50)},ni=()=>{$("#"+ge).val(""),Ot()};setInterval(()=>{const e=p();e&&e.idAutoClearLog&&ni()},12e4);const ii=()=>{let e=u("userPlatform");return e||(services.User.getUser().getSelectedPersona().isPC?(d("userPlatform","pc"),"pc"):(d("userPlatform","ps"),"ps"))},si=()=>new Promise(e=>{services.User.requestCurrencies().observe(void 0,function(t,n){e()})});let oi,ri;const ai=function(e){if(!u("autoBuyerActive"))return;const t=1e3*S(e.idAbPauseFor);ri=ri||A(e.idAbCycleAmount);const{searchCount:n,previousPause:i}=u("sessionStats");return!n||(n-i)%ri?void 0:(Rt("previousPause",n),si(),zi(!0),setTimeout(()=>{ri=A(e.idAbCycleAmount),Ji.call(this,!0)},t))},li=async function(){const e=u("selectedFilters"),t=u("fiterSearchCount"),n=u("currentFilterCount");if(!e||!e.length||t>n)return m("currentFilterCount"),!1;d("currentFilterCount",1),d("currentPage",1);const i=u("currentFilterIndex")||0;let s=u("runSequentially")?i%e.length:_(0,e.length-1);d("currentFilterIndex",s+1);let o=e[s];return await Ln.call(this,o),ti(`Running for filter ${o}`,ge),!0},ci="MAGIC_BUYER_BACKGROUND_FETCH";let di=0;const ui=async e=>{l?pi(e):await mi(e)},pi=e=>{d(e.identifier,e.onload),delete e.onload,window.ReactNativeWebView.postMessage(JSON.stringify({type:"fetchFromExternalAB",payload:{options:e}}))},mi=async e=>{try{const n=await(t={method:e.method,url:e.url,headers:e.headers,body:e.data},new Promise((e,n)=>{const i=`${ci}_${Date.now()}_${di++}`,s=t=>{if(t.source!==window||!t.data)return;const{type:o,id:r,success:a,payload:l,error:c}=t.data;"MAGIC_BUYER_BACKGROUND_FETCH_RESPONSE"===o&&r===i&&(window.removeEventListener("message",s),a?e(l):n(new Error(c||"Background fetch failed")))};window.addEventListener("message",s),window.postMessage({type:ci,id:i,payload:t},"*")}));e.onload?.({status:n.status,response:n.body,responseText:n.body,responseHeaders:n.headersRaw})}catch(t){e.onerror?e.onerror(t):console.error("Failed to perform external request",t)}var t},fi=(e,t,n)=>new Promise((i,s)=>{ui({method:t,identifier:n,url:e,onload:e=>200!==e.status?s():i(e.response)})}),gi=async(e,t)=>{try{const n=await bi(e),i=ii();if(!n)return;const s=await fi(`https://www.futwiz.com/en/app/sold23/${n[0].lineid}/console`,"GET",`${e.definitionId}_fetchFutWizPlayerPrices`),o=JSON.parse(s);let r=o.prices[i].bin;"ps"!==i||r||(r=o.prices.xb.bin);const a=parseInt(r.replace(/[,.]/g,"")),l=`${e.definitionId}_futwiz_price`,c={expiryTimeStamp:new Date(Date.now()+9e5),price:a};d(l,c),t.set(l,a)}catch(e){console.log(e)}},bi=e=>new Promise((t,n)=>{const i=TextUtils.stripSpecialCharacters("---"!==e._staticData.knownAs?e._staticData.knownAs:e._staticData.name);ui({url:`https://www.futwiz.com/en/searches/player23/${i}`,method:"GET",identifier:`${e.definitionId}_getFutWizPlayerUrl`,onload:n=>{if(200!==n.status)return t();const i=JSON.parse(n.response);if(!i)return t();let s=i.filter(t=>parseInt(t.rating)===e.rating);i&&!s.length&&(s=i),s&&s.length>1&&(s=s.filter(t=>t.rare===e.rareflag.toString()&&t.club===e.teamId+"")),t(s)}})}),hi=async e=>{const t=new Map,n=new Map;let i=[];for(const i of e){if(!i.definitionId)continue;const e=u(`${i.definitionId}_futwiz_price`);e?t.set(`${i.definitionId}_futwiz_price`,e.price):i.isPlayer()&&n.set(i.definitionId,i)}if(n.size)for(const e of n.values())i.push(gi(e,t));return await Promise.all(i),t},yi=e=>{const t=services.Localization;return t?e.isManagerContract()?t.localize("card.title.managercontracts"):e.isPlayerContract()?t.localize("card.title.playercontracts"):e.isStyleModifier()?UTLocalizationUtil.playStyleIdToName(e.subtype,t):e.isPlayerPositionModifier()?t.localize("card.desc.training.pos."+e._staticData.trainPosFrom+"_"+e._staticData.trainPosTo).replace(" >> ","->"):e._staticData.name:""},vi=(e,t,n)=>e>=t&&e<=n,wi=new Set(["Position","Chemistry Style"]),Si=async(e,t)=>{const n=Array.from(e),i=ii();for(;n.length;){const e=n.splice(0,30),s=e.shift();if(!s)continue;const o=e.join(",");try{const n=await fi(`https://www.futbin.com/24/playerPrices?player=${s}&rids=${o}`,"GET",`${Math.floor(+new Date)}_fetchPlayerPrices`),r=JSON.parse(n);for(const n of[s,...e]){const e=r[n].prices[i].LCPrice;if(!e)continue;const s=parseInt(e.replace(/[,.]/g,"")),o=`${n}_futbin_price`,a={expiryTimeStamp:new Date(Date.now()+9e5),price:s};d(o,a),t.set(o,s)}}catch(e){console.log(e)}}},Ai=async(e,t)=>{const n=ii(),i="ps"===n?"PS":"xbox"===n?"XB":"PC",s=Array.from(e.keys());for(const n of s)try{const s=n.split(" ")[0],o=await fi(`https://www.futbin.org/futbin/api/fetchConsumables?category=${s}&platformtype=${i}`,"GET",`${Math.floor(+new Date)}_fetchConsumablesPrices`),r=JSON.parse(o).data.reduce((e,t)=>(e.set(t.SubType.toUpperCase(),t.LCPrice),e),new Map),a=e.get(n)||[];for(const{definitionId:e,subType:n}of a){let i=r.get(n);const s=`${e}_futbin_price`;if(i){const e={expiryTimeStamp:new Date(Date.now()+9e5),price:i};d(s,e),t.set(s,i)}}}catch(e){console.log(e)}},$i=async e=>{const t=new Map,n=new Set,i=new Map;for(const s of e){if(!s.definitionId)continue;const e=u(`${s.definitionId}_futbin_price`);e?t.set(`${s.definitionId}_futbin_price`,e.price):s.isPlayer()?n.add(s.definitionId):s.isTraining()&&wi.has(s._staticData.name)&&(i.has(s._staticData.name)||i.set(s._staticData.name,[]),i.get(s._staticData.name).push({definitionId:s.definitionId,subType:yi(s)}))}const s=[];return n.size&&s.push(Si(n,t)),i.size&&s.push(Ai(i,t)),await Promise.all(s),t},Ci=async e=>{const t=f();return"FUTWIZ"===t?hi(e):"FUTBIN"===t?$i(e):void 0},Ti=e=>{let t=JSUtils.find(UTCurrencyInputControl.PRICE_TIERS,function(t){return e>=t.min});var n=Math.round(e/t.inc)*t.inc;return Math.max(Math.min(n,14999e3),0)},_i=e=>e<=1e3?e-50:e>1e3&&e<=1e4?e-100:e>1e4&&e<=5e4?e-250:e>5e4&&e<=1e5?e-500:e-1e3,Bi=e=>e<1e3?e+50:e>=1e3&&e<1e4?e+100:e>=1e4&&e<5e4?e+250:e>=5e4&&e<1e5?e+500:e+1e3,Pi=async(e,t,n)=>{let i;try{const s=n.definitionId,o=f();if("player"!==n.type)return i;await Ci([n]);const r=u(`${s}_${o.toLowerCase()}_price`);if(r&&r.price){i=r.price;const s=A(e.idSellFutBinPercent)||100;let a=i*s/100;await Ii(n),n.hasPriceLimits()&&(a=Ti(Math.min(n._itemPriceLimits.maximum,Math.max(n._itemPriceLimits.minimum,a))),a===n._itemPriceLimits.minimum&&(a=Bi(a))),a=Ti(a),ti(`= ${o} price for ${t}: ${i}: ${s}% of sale price: ${a}`,ge),i=a}else i=null,ti(`= Unable to get ${o} price for ${t}`,ge)}catch(e){e=e.statusText||e.status||e,i=null,ti(`= Unable to get Futbin price for ${t}, err: ${e||"error occured"}`,ge)}return i},Ii=async e=>new Promise(t=>{e.hasPriceLimits()?t():services.Item.requestMarketData(e).observe(void 0,async function(e,n){t()})}),Mi=e=>{const t=u("sessionStats");t.transactions=t.transactions||[],t.transactions.push(e),d("sessionStats",t)},xi=()=>{const{coinsNumber:e,searchCount:t,profit:n,runningTime:i,transactions:s}=u("sessionStats");let o="Available Coins,Search Count,Profit,Running Time,BIN Won Count,BID Won Count,Loss Count\n";o+=`${e||""},${t||""},${n||0},${i||""},${u("winCount")||0},${u("bidCount")||0},${u("lossCount")||0}\n\n`,o+="Transactions\n",o+=s.map(e=>`${e}\n`).join(""),((e,t)=>{l?y(e,t):w(e,t)})(o,"Stats")};setInterval(()=>{const e=u("sessionStats");e.searchPerMinuteCount=0,d("sessionStats",e)},55e3);const Ei=new Map,Di=(e,t,n,i,s,r)=>{const a=p();return new Promise(l=>{services.Item.bid(e,n).observe(void 0,async function(c,p){let f=P(n.toString(),6);const g=a.idNotificationType;if(p.success){s&&(m("purchasedCardCount"),I("cardWon"));const o=a.idSellRatingThreshold;let l=parseInt(e.rating);const c=!o||l<=o,p=a.idSellFutBinPrice;c&&p&&s&&(i=await Pi(a,t,e));a.idSellCheckBuyPrice&&n>95*i/100&&(i=-1);const b=i&&!isNaN(i)&&c,h=.95*i-n;if(s){const s=m("winCount");if(Mi(`[${(new Date).toLocaleTimeString()}] ${t.trim()} achat avec succès - Prix : ${n}`),Rt("winCount",s),ti(`<h2>${t}</h2> <br>Acheté à ${n} <br>Vendu à ${i} <br>Bénéfice de ${h}`,ge,e,"success"),!a.idAbDontMoveWon){const n=u("sellQueue")||[];n.push({player:e,playerName:t,sellPrice:i,shouldList:b,profit:h}),d("sellQueue",n)}}else{const i=m("bidCount");Mi(`${t.trim()} succès de l'enchère - Prix : ${n}`),ti(`B:${i} ${t} succès de l'enchère`,ge,e,"success");const s=u("currentFilter")||"default";if(s){const e=u("filterBidItems")||new Map;e.has(s)?e.get(s).add(r):e.set(s,new Set([r])),d("filterBidItems",e)}}"B"!==g&&"A"!==g||Gn("| "+t.trim()+" | "+f.trim()+` | ${s?"buy":"bid"} |`,!0)}else{m("lossCount");Mi(`[${(new Date).toLocaleTimeString()}] ${t.trim()} buy failed - Price : ${n}`);let i=(p.error&&p.error.code||p.status)+"";if(ti(`${t} - échec de l'${s?"achat":"enchère"} - ERR: (${o[i]+"("+i+")"||0})`,ge,e,"error"),"L"!==g&&"A"!==g||Gn("| "+t.trim()+" | "+f.trim()+" | failure |",!1),a.idAbStopErrorCode){const t=new Set(a.idAbStopErrorCode.split(","));if(Ei.has(i)||Ei.set(i,{currentVal:0}),Ei.get(i).currentVal++,t.has(i)&&Ei.get(i).currentVal>=a.idAbStopErrorCodeCount&&(ti(`[!!!] Autostopping bot since error code ${i} has occured ${Ei.get(i).currentVal} times\n`,ge,e,"error"),Ei.clear(),zi(),a.idAbResumeAfterErrorOccured)){const t=S(a.idAbResumeAfterErrorOccured);ti(`Le bot reprendra dans ${t}(s)`,ge,e,"error"),setTimeout(()=>{Ji.call(u("AutoBuyerInstance"))},1e3*t)}}}a.idAbAddBuyDelay&&await b(T(a.idAbDelayToAdd)),l()})})},Fi=new Set,Ni=function(e){return Hn("Transfer Targets - List View"),new Promise(t=>{services.Item.clearTransferMarketCache(),services.Item.requestWatchedItems().observe(this,function(n,i){let s=e.idAbMaxBid,o=e.idAbSellPrice,r=i.response.items.filter(function(e){return!!e._auction});if(!r.length)return t();services.Item.refreshAuctions(r).observe(this,function(n,i){services.Item.requestWatchedItems().observe(this,async function(n,i){const r=u("autoBuyerActive"),a=u("currentFilter")||"default",l=(u("filterBidItems")||new Map).get(a)||new Set,c=u("userWatchItems");if(r&&s){let t=i.response.items.filter(function(e){return"outbid"===e._auction._bidState&&(!a||l.has(e._auction.tradeId))&&!c.has(e._auction.tradeId)&&"active"===e._auction._tradeState});if(t.length){const n=t[_(0,t.length-1)];await Ri(n,s,o,e)}}const p=e.idSellFutBinPrice;if(r&&!e.idAbDontMoveWon&&(o&&!isNaN(o)||p)){let t=i.response.items.filter(function(e){return e.getAuctionData().isWon()&&(!a||l.has(e._auction.tradeId))&&!c.has(e._auction.tradeId)&&!Fi.has(e._auction.tradeId)});for(var m=0;m<t.length;m++){const n=t[m],i=e.idSellRatingThreshold;let s=parseInt(n.rating);const r=!i||s<=i;let a=P(n._staticData.name,15),l=n._auction.currentBid;r&&p&&(o=await Pi(e,a,n));e.idSellCheckBuyPrice&&l>95*o/100&&(o=-1);const c=o&&!isNaN(o)&&r;if(c&&Fi.add(n._auction.tradeId),!e.idAbDontMoveWon){const e=u("sellQueue")||[],t=.95*o-l;e.push({player:n,sellPrice:o,playerName:a,shouldList:c,profit:t}),d("sellQueue",e)}}}let f=i.response.items.filter(e=>{var t=e.getAuctionData();return t.isExpired()||t.isClosedTrade()&&!t.isWon()});e.idAutoClearExpired&&f.length&&(services.Item.untarget(f),ti(`${f.length} élément(s) expirés et supprimés de la liste d'objectifs`,ge)),services.Item.clearTransferMarketCache(),t()})})})})},Ri=async(e,t,n,i)=>{let s=e._auction,o=s.currentBid,r=s.currentBid||s.startingBid,a=P(e._staticData.name,15);const l=u("autoBuyerActive");let c=i.idAbBidExact?t:o?_i(t):t,d=i.idAbBidExact?t:o?Bi(r):r;l&&r<=c&&(ti("Enchèr sur un élement en surenchère -> Prix d'enchère :"+d,ge),await Di(e,a,d,n),i.idAbAddBuyDelay&&await b(1))},Ui=()=>{const e=p();let t=e.idAntiCaptchKey,n=e.idProxyAddress,i=e.idProxyPort,s=e.idProxyLogin,o=e.idProxyPassword;if(!n||!i||!t)return ti("Proxy info not filled properly",ge),void ei(e.idAbCloseTabToggle);function r(e){let n={clientKey:t,taskId:e};var i=new XMLHttpRequest;i.open("POST","https://api.anti-captcha.com/getTaskResult",!0),i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=function(){if(4===i.readyState&&200===i.status){var t=JSON.parse(i.responseText);if(0==t.errorId)if("ready"==t.status){new UTCaptchaViewModel(accessobjects.Captcha).validateToken(t.solution.token).observe(this,function(e,t){if(t.success){ti("Captcha Solved",ge);const e=u("AutoBuyerInstance");Ji.call(e)}})}else setTimeout(()=>r(e),1e3);else ti("Error occured when checking captcha result : "+t.errorCode+", "+t.errorDescription,ge)}};var s=JSON.stringify(n);i.send(s)}!function(){accessobjects.Captcha.getCaptchaData().observe(this,function(e,a){if(a.success){if(!(c=a.response.blob))return!1;let e={clientKey:t,task:{type:"FunCaptchaTask",websiteURL:"https://www.ea.com/ea-sports-fc/ultimate-team/web-app/",websitePublicKey:"A4EECF77-AC87-8C8D-5754-BF882F72063B",funcaptchaApiJSSubdomain:"ea-api.arkoselabs.com",data:a.response,proxyType:"http",proxyAddress:n,proxyPort:i,proxyLogin:s,proxyPassword:o,userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36"}};var l=new XMLHttpRequest;l.open("POST","https://api.anti-captcha.com/createTask",!0),l.setRequestHeader("Content-Type","application/json"),l.onreadystatechange=function(){if(4===l.readyState&&200===l.status){var e=JSON.parse(l.responseText);0==e.errorId?r(e.taskId):ti("Got error from Captcha API: "+e.errorCode+", "+e.errorDescription,ge)}};var c=JSON.stringify(e);return l.send(c),!0}})}()},ki=new Set,Li=function(e){return new Promise(t=>{const n=T(e.idAbItemExpiring),i=e.idAbRandMinBidToggle,s=e.idAbRandMinBuyToggle,o=e.idBuyFutBinPercent||100;let r=u("currentPage")||1;Ut("searchPerMinuteCount")>15&&(e.idAbOverSearchWarning||void 0===e.idAbOverSearchWarning)&&ti("<h2>Attention !</h2> <br>Plus de 15 recherches effectuées en une minute, vous devez augmenter votre temps d'attente entre les recherches !",ge,null,"warning");const a=new Set((e.idAddIgnorePlayersList||[]).map(({id:e})=>e)),l=f();let c=e.idAbMaxBid,p=e.idAbBuyPrice,g=e.idBuyFutBinPrice||e.idAbBidFutBin;if(!p&&!c&&!g)return ti("skip search >>> (No Buy or Bid Price given)",ge),t();Hn("Transfer Market Search"),(()=>{const e=u("sessionStats");e.searchCount++,e.searchPerMinuteCount++,d("sessionStats",e)})();let b=this.viewmodel.searchCriteria;i&&(b.minBid=Ti(_(0,e.idAbRandMinBidInput))),s&&(b.minBuy=Ti(_(0,e.idAbRandMinBuyInput))),services.Item.clearTransferMarketCache(),services.Item.searchTransferMarket(b,r).observe(this,async function(i,s){if(s.success){d("searchFailedCount",0);let t=!0;ti(`<h2>Aucun élément trouvé !</h2> <br>Page n°${r} <br>Enchère min à ${b.minBid} <br>Achat immédiat min à ${b.minBuy}`,ge),s.data.items.length>0&&(1===r&&Hn("Transfer Market Results - List View"),g&&"player"===s.data.items[0].type&&await Ci(s.data.items)),s.data.items.length>e.idAbSearchResult&&(t=!1);let i=e.idAbMaxPurchases||1;e.idAbShouldSort&&(s.data.items=((e,t,n)=>{let i=e=>e._auction.buyNowPrice;return"bid"===t?i=e=>e._auction.currentBid||e._auction.startingBid:"rating"===t?i=e=>parseInt(e.rating):"expires"===t&&(i=e=>parseInt(e._auction.expires)),e.sort((e,t)=>{const s=i(e),o=i(t);return n?s-o:o-s}),e})(s.data.items,e.idAbSortBy||"buy",e.idAbSortOrder));for(let r=s.data.items.length-1;r>=0&&u("autoBuyerActive");r--){let d=s.data.items[r],m=d._auction,f=services.Localization.localizeAuctionTimeRemaining(m.expires),b=d.type,{id:h}=d._metaData||{},y=parseInt(d.rating);if(g&&"player"===b){const t=u(`${d.definitionId}_${l.toLowerCase()}_price`);if(!t||!t.price){ti(`Price unavailable for ${d._staticData.name}`,ge);continue}{const n=Ti(t.price*o/100);p=n,e.idAbBidFutBin&&(c=n)}}let v=m.buyNowPrice,w=m.currentBid||m.startingBid,S=m.currentBid,A=e.idAbBidExact?c:S?_i(c):c,$=e.idAbBidExact?A:S?Bi(w):w,C=e.idAbSellPrice,T=e.idAbMinRating,_=e.idAbMaxRating,B=d._staticData.name;const P=!(T||_)||vi(y,T,_),I=Oi(`${B}(${y}) Prix: ${v} temps: ${f}`);if(!e.idAbIgnoreAllowToggle&&a.has(h)||e.idAbIgnoreAllowToggle&&!a.has(h)){I("(Joueur ignoré)");continue}if(!t){I("(Seuil de résultats de recherche dépassé)");continue}if(i<1)break;if(!d.preferredPosition&&e.idAbAddFilterGK){I("(est un Gardien)");continue}if(!P){I("(la note ne correspond pas aux critères)");continue}if(ki.has(m.tradeId)){I("(Cached Item)");continue}const M=services.User.getUser().coins.amount;if(!c&&M<v||c&&M<$)I("(Coins insuffisants pour acheter/enchérir)");else if(v<=p)I("essaye d'achat à: "+v),i--,ki.add(m.tradeId),await Di(d,B,v,C,!0,m.tradeId);else if(c&&w<=A){if(m.expires>n){I("(Attente de l'heure d'expiration spécifiée)");continue}I("tentative d'enchère à: "+$),ki.add(m.tradeId),i--,await Di(d,B,$,C,$===v,m.tradeId)}else I(p&&v>p||c&&w>A?`Prix d'achat: ${p||A} (supérieur au prix d'achat/offre spécifié)`:"(Aucune action requise)")}}else((e,t,n)=>{let i=!1;if(e.status===UtasErrorCode.CAPTCHA_REQUIRED||e.error&&e.error.code==UtasErrorCode.CAPTCHA_REQUIRED)i=!0,t?(ti("[!!!] Captcha got triggered, trying to solve it",ge),Ui()):ei(n);else{const t=m("searchFailedCount");t>=3?(i=!0,ti(`[!!!] Autostopping bot as search failed for ${t} consecutive times, please check if you can access transfer market in Web App ${e.status}`,ge)):ti(`[!!!] Search failed - ${e.status}`,ge)}i&&(I("capatcha"),zi())})(s,e.idAbSolveCaptcha,e.idAbCloseTabToggle);Hn("Transfer Market Search"),r<e.idAbMaxSearchPage&&21===s.data.items.length?m("currentPage"):d("currentPage",1),t()})})},Oi=e=>t=>{ti(e+" "+t,ge)},Wi=function(e,t,n){return Hn("Transfer List - List View"),new Promise(i=>{n||repositories.Item.isDirty(ItemPile.TRANSFER)?services.Item.requestTransferItems().observe(this,async function(n,s){let o=s.response.items.filter(function(e){return e.getAuctionData().isSold()}).length;Ut("soldItems")<o&&await si(),Rt("soldItems",o);const r=s.response.items.filter(function(e){return!e.getAuctionData().isSold()&&e.getAuctionData().isExpired()}).length;Rt("unsoldItems",r);const a=o>=t;r&&e&&services.Item.relistExpiredAuctions().observe(this,function(e,t){!a&&UTTransferListViewController.prototype.refreshList()});const l=s.response.items.filter(function(e){return e.getAuctionData().isSelling()}).length;Rt("activeTransfers",l);const c=s.response.items.filter(function(e){return e.getAuctionData().isInactive()}).length;Rt("availableItems",c);const d=services.User.getUser().coins.amount;Rt("coinsNumber",d),Rt("coins",d.toLocaleString()),a&&(ti("[TRANSFER-LIST] > "+o+" item(s) sold\n",ge),UTTransferListViewController.prototype._clearSold()),i()}):i()})},Vi=function(){return{switchFilterWithContext:li.bind(this),srchTmWithContext:Li.bind(this),watchListWithContext:Ni.bind(this),transferListWithContext:Wi.bind(this),pauseBotWithContext:ai.bind(this)}},Hi=async()=>{const e=u("sellQueue")||[],t=p();t.idAbSendListingNotificationToggle,e.length;for(;e.length;){const{player:n,sellPrice:i,shouldList:s,playerName:o,profit:r}=e.pop();await Gi(n,i,r,s,t);e.length&&await b(2)}},Gi=(e,t,n,i,s)=>new Promise(o=>{if(t<0)services.Item.move(e,ItemPile.TRANSFER).observe(void 0,async function(){o()});else if(i){if(repositories.Item.isPileFull(ItemPile.TRANSFER))return o("Unable to list, transfer List if Full");(e=>{const t=u("sessionStats");t.profit+=e,d("sessionStats",t)})(n),services.Item.list(e,_i(t),t,T(s.idFutBinDuration||"1H")||3600).observe(void 0,async function(e,t){o()})}else services.Item.move(e,ItemPile.CLUB).observe(void 0,async function(e,t){o()})});let qi=null,ji=null;const Ji=async function(e){$("#"+xe).css("color","#2cbe2d").html("RUNNING");if(u("autoBuyerActive"))return;(e=>{Vn(e?"Autobuyer Resumed":"Autobuyer Started"),d("autoBuyerActive",!0),d("autoBuyerState","Active"),isPhone()&&$(".ut-tab-bar-item").attr("disabled",!0),e||(d("botStartTime",new Date),d("purchasedCardCount",0),d("searchFailedCount",0),d("currentPage",1))})(e);const{switchFilterWithContext:t,srchTmWithContext:n,watchListWithContext:i,transferListWithContext:s,pauseBotWithContext:o}=Vi.call(this);await t();let r=p();!e&&await new Promise((e,t)=>{services.Item.requestWatchedItems().observe(void 0,function(t,n){if(n.success){const e=u("filterBidItems")||new Map,t=new Set(Array.from(e.values()).flat(1).reduce((e,t)=>e.concat([...t]),[])),i=n.response.items.filter(e=>e._auction&&!t.has(e._auction.tradeId)).map(e=>e._auction.tradeId)||[];d("userWatchItems",new Set(i)),i.length&&ti(`${i.length} élément(s) trouvé(s) dans la liste d'objectifs de transferts et ignoré(s)`,ge)}e()})}),Hn("Hub - Transfers"),await n(r),Hn("Hub - Transfers"),await s(r.idAbSellToggle,r.idAbMinDeleteCount,!0);let a=!1;u("autoBuyerActive")&&(qi=((e,t,n)=>{let i,s=!1;const o=()=>{if(s)return;const r={start:Date.now()},a=1e3*parseFloat((Math.random()*(n-t)+t).toFixed(1));r.end=r.start+a,d("searchInterval",r),i=setTimeout(()=>{e(),o()},a)};return o(),{clear(){s=!0,clearTimeout(i)}}})(async()=>{ji=o(r),(e=>{const t=u("purchasedCardCount"),n=e.idAbCardCount,i=u("botStartTime").getTime();let s=oi||S(e.idAbStopAfter);oi||(oi=s);let o=((new Date).getTime()-i)/1e3>=s;(o||n&&t>=n)&&(ti("Autobuyer stopped | "+(o?"Time elapsed":"Max purchases count reached"),ge),oi=null,ri=null,zi())})(r);u("autoBuyerActive")&&!a&&(a=!0,await Hi(),await t(),r=p(),Hn("Hub - Transfers"),await n(r),Hn("Hub - Transfers"),await i(r),Hn("Hub - Transfers"),await s(r.idAbSellToggle,r.idAbMinDeleteCount)),a=!1},...B(r.idAbWaitTime)))},zi=e=>{qi&&qi.clear(),!e&&ji&&clearTimeout(ji);const t=u("autoBuyerState");if(e&&t===i||!e&&t===s)return;d("autoBuyerActive",!1);const n=u("searchInterval")||{};d("searchInterval",{start:n.start,end:Date.now()}),e||I("finish"),isPhone()&&$(".ut-tab-bar-item").removeAttr("disabled"),d("autoBuyerState",e?i:s),Vn(e?"Autobuyer Paused":"Autobuyer Stopped"),e||Hi(),$("#"+xe).css("color","red").html(e?"PAUSED":"IDLE")},Yi=()=>`<span style='color:red' id="${xe}"> IDLE </span> | REQUEST COUNT: <span id="${Pe}">0</span> \n  `,Xi=()=>isPhone()?Ki():Qi(),Ki=()=>`<div class="view-navbar-currency">\n            <span id=${yt} style="font-weight: bold;\n            margin: auto 2px;">00:00:00</span>\n            <div style="margin: auto 2px;">Search:</div> \n            <div class="stats-progress">\n              <div id=${_e} class="stats-fill"></div>\n            </div>\n            <div class="view-navbar-currency-coins ab">Coins: <span id=${Ie}></span></div>\n            <div class="view-navbar-currency-coins ab">Profit: <span id=${et}></span></div>\n            <div class="view-navbar-currency-coins ab">Won: <span id=${Me}></span></div>\n            ${Qt(vt,"⇩",()=>{xi()},"filterSync download-stats")} \n          </div>`,Qi=()=>`\n  <div class="view-navbar-clubinfo-data">\n    <div class="view-navbar-clubinfo-name">\n    ${Qt(vt,"⇩",()=>{xi()},"filterSync")}\n    </div>\n  </div>\n  <div class="view-navbar-clubinfo">\n    <div class="view-navbar-clubinfo-data">\n      <div class="view-navbar-clubinfo-name">\n        <span id=${yt} style="font-weight: bold;">00:00:00</span>\n      </div>\n    </div>\n  </div>\n  <div class="view-navbar-clubinfo">\n    <div class="view-navbar-clubinfo-data">\n       <div class="view-navbar-clubinfo-name">\n          <div style="float: left;">Search:</div>\n          <div class="stats-progress">\n             <div id=${_e} class="stats-fill"></div>\n          </div>\n       </div>\n       <div class="view-navbar-clubinfo-name">\n          <div style="float: left;">Statistics:</div>\n          <div class="stats-progress">\n             <div id=${Be} class="stats-fill"></div>\n          </div>     \n       </div>\n    </div>\n  </div>\n  <div class="view-navbar-currency" style="margin-left: 10px;">\n    <div class="view-navbar-currency-coins ab">Coins: <span  id=${Ie}></span></div>\n    <div class="view-navbar-currency-coins ab">Profit: <span  id=${et}></span></div>\n    <div class="view-navbar-currency-coins ab">Won: <span id=${Me}></span></div>\n  </div>\n  <div class="view-navbar-clubinfo">\n    <div class="view-navbar-clubinfo-data">\n       <span class="view-navbar-clubinfo-name">Sold Items: <span id=${Ee}></span></span>\n       <span class="view-navbar-clubinfo-name">Unsold Items: <span id=${De}></span></span>\n    </div>\n  </div>\n  <div class="view-navbar-clubinfo" style="border: none;">\n    <div class="view-navbar-clubinfo-data">\n       <span class="view-navbar-clubinfo-name">Available Items: <span id=${Fe}></span></span>\n       <span class="view-navbar-clubinfo-name">Active transfers: <span id=${Ne}></span></span>\n    </div>\n  </div>`,{R:Zi,T:es}=n,ts=function(e){UTMarketSearchFiltersViewController.call(this)},ns=UTMarketSearchFiltersViewController.prototype.init,is=UTMarketSearchFiltersViewController.prototype.viewDidAppear;JSUtils.inherits(ts,UTMarketSearchFiltersViewController),JSUtils.inherits(UTMarketSearchFiltersViewController,UTMarketSearchFiltersViewController),ts.prototype.init=function(){ns.call(this);let e=this.getView();isPhone()||(e.__root.style="width: 100%; float: left;"),d("AutoBuyerInstance",this);const t=_n.call(this);let n=$(e.__root);const i=kt.bind(this),s=i("Stop",()=>es.call(this)),o=i("Clear Log",()=>ni.call(this),"btn-other"),r=i("Start",()=>{Zi.call(this),$(".ut-navigation-container-view--content").animate({scrollTop:$(".ut-navigation-container-view--content").prop("scrollHeight")},400)},"call-to-action");setInterval(()=>{isPhone()?Dt():Ft()},1e3),n.addClass("auto-buyer");const a=n.find(".button-container");a.addClass("buyer-actions"),a.find(".call-to-action").remove();const l=a.find('button:contains("Reset")');l.on("click touchend",async function(){$(`#${E}`).prop("selectedIndex",0),await Bn()}),l.addClass("btn-other"),a.append($(r.__root)),a.append($(s.__root)),a.append($(o.__root)),$(t.__root).find(".menu-container").addClass("settings-menu"),n.find(".search-prices").append(t.__root)},ts.prototype.viewDidAppear=function(){this.getNavigationController().setNavigationVisibility(!0,!0),ss.call(this,!1)},UTMarketSearchFiltersViewController.prototype.viewDidAppear=function(){ss.call(this,!0)};const ss=function(e){is.call(this);let t=this.getView(),n=$(t.__root);n.find(".filter-place").length||Sn.call(this,e).then(e=>{n.find(".ut-item-search-view").first().prepend(e)})};ts.prototype.getNavigationTitle=function(){return setTimeout(()=>{const e=$(".title");isPhone()&&e.addClass("buyer-header"),$(".view-navbar-currency").remove(),$(".view-navbar-clubinfo").remove(),e.append(Yi()),$(Xi()).insertAfter(e),$(".ut-navigation-container-view--content").find(`#${It}`).remove(),$(".ut-navigation-container-view--content").append(Lt()),Ot(),x(u("CommonSettings")||{})}),"MagicBuyer "};const os="MAGIC_BUYER_PAGE_COMMAND_RESPONSE",rs={start:async()=>{const e=as();return await Ji.call(e),{state:"started"}},resume:async()=>{const e=as();return await Ji.call(e,!0),{state:"resumed"}},stop:async()=>{const e=as();return zi.call(e,!1),{state:"stopped"}},pause:async()=>{const e=as();return zi.call(e,!0),{state:"paused"}},clearLogs:async()=>(ni(),{cleared:!0}),getStatus:async()=>cs(),getLogs:async()=>{const e=document.getElementById(ge);return{html:e?e.innerHTML:""}},open:async()=>(ls(),{opened:!0}),getSettingsSummary:async()=>{const e=Array.from($n.entries()).map(([e,t])=>({index:e,label:t.label})),t=await yn(),n=u("activeSettingsTab")??0,i=document.getElementById(E)||document.getElementById(`${E}transfer`);return{categories:e,activeCategoryIndex:n,filters:t,activeFilter:i?.value||"",selectedFilters:u("selectedFilters")||[]}},setActiveSettingsTab:async({index:e})=>{if("number"!=typeof e||Number.isNaN(e))throw new Error("A valid settings index is required");ls();const t=(e=>{if(!Tn||!$n.has(e))return!1;Tn.setActiveTab(e),En(),d("activeSettingsTab",e);const t=$n.get(e).selector;return $(t).css("display",""),!0})(e);if(!t)throw new Error("Settings are not available yet. Open the MagicBuyer tab in the web app first.");return{activeCategoryIndex:e}},openSettings:async()=>{ls();let e=u("AutoBuyerInstance");e&&e.__mbDevMounted||(e=function(){try{const e=new ts,t=window._navigationController||window.navigationController||document.querySelector(".ut-navigation-container-view")?.__vue__?.$root?.navigationController||null;return t&&(t._viewControllerStack=t._viewControllerStack||[],t.pushViewController(e,!0)),e.__mbDevMounted=!0,e}catch(e){throw console.error("Failed to mount AutoBuyerViewController:",e),new Error("No se pudo montar la vista de MagicBuyer (dev). Abre la UT web app y vuelve a intentarlo.")}}(),setValue("AutoBuyerInstance",e)),function(){const e=document.querySelector(".title");if(e&&!e.querySelector(".buyer-header")){try{e.appendChild(Yi())}catch{}try{const t=Xi();t&&t.parentNode!==e.parentNode&&e.insertAdjacentElement("afterend",t)}catch{}}const t=document.querySelector(".ut-navigation-container-view--content");if(t&&!t.querySelector(`#${It}`)){t.appendChild(Lt()),Ot();try{x(u("CommonSettings")||{})}catch{}}}(),await async function(){const e=document.querySelector(".ut-item-search-view");if(!e)return;if(!e.querySelector(".filter-place")){const t=await Sn.call(u("AutoBuyerInstance")||window,!0);t&&e.prepend(t)}if(!document.querySelector(".settings-menu")){await Bn();const t=_n.call(u("AutoBuyerInstance")||window),n=document.querySelector(".search-prices")||e,i=t?.__root||t;i&&(i.querySelector?.(".menu-container")?.classList?.add("settings-menu"),n.appendChild(i))}document.querySelector(".auto-buyer")?.classList?.add("dev-layout")}();const t=document.getElementById(E);return t&&t.focus(),{opened:!0,section:"settings"}}};const as=()=>{const e=u("AutoBuyerInstance");if(!e)throw new Error("MagicBuyer view is not initialized yet. Open the Ultimate Team web app and visit the MagicBuyer tab first.");return e};function ls(){const e=Array.from(document.querySelectorAll(".ut-tab-bar-item")).filter(e=>"MagicBuyer"===e.textContent?.trim());if(e.length){const t=e[0];t.dispatchEvent(new MouseEvent("click",{bubbles:!0})),t.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0})),t.dispatchEvent(new MouseEvent("mouseup",{bubbles:!0}))}}const cs=()=>{const e=e=>document.getElementById(e)?.textContent?.trim()||"";return{statusText:e(xe),requestCount:e(Pe),coins:e(Ie),profit:e(et),won:e(Me),sold:e(Ee),unsold:e(De),available:e(Fe),activeTransfers:e(Ne),searchProgress:ds(_e),statisticsProgress:ds(Be),countdown:e(yt)}},ds=e=>{const t=document.getElementById(e);if(!t)return 0;const n=/([0-9.]+)%/.exec(t.style.width||"");return n?Number(n[1]):0},us=()=>{window.addEventListener("message",e=>{if(e.source!==window||!e.data)return;const{type:t,id:n,payload:i}=e.data;"MAGIC_BUYER_PAGE_COMMAND"===t&&n&&Promise.resolve().then(()=>(async e=>{if(!e||!e.command)throw new Error("Invalid command");const t=rs[e.command];if(!t)throw new Error(`Unknown command: ${e.command}`);return await t(e.args||{})})(i)).then(e=>{window.postMessage({type:os,id:n,success:!0,payload:e},"*")}).catch(e=>{window.postMessage({type:os,id:n,success:!1,error:e?.message||"Unknown command error"},"*")})})};function ps(){const e=document.querySelector(".ut-content")||document.body;let t=document.getElementById("magic-buyer-root");t||(t=document.createElement("div"),t.id="magic-buyer-root",e.appendChild(t)),t.innerHTML=`\n  <div class="mb-wrap">\n    <div class="mb-header">\n      <h1>MagicBuyer</h1>\n      <div class="mb-controls">\n        <button id="mb-start" class="btn">Start</button>\n        <button id="mb-resume" class="btn">Resume</button>\n        <button id="mb-pause" class="btn">Pause</button>\n        <button id="mb-stop" class="btn">Stop</button>\n        <button id="mb-clear" class="btn">Clear Logs</button>\n      </div>\n    </div>\n\n    <div class="mb-grid">\n      <div class="mb-card">\n        <h3>Status</h3>\n        <div><strong>Estado:</strong> <span id="${xe}">—</span></div>\n        <div><strong>Requests:</strong> <span id="${Pe}">0</span></div>\n        <div><strong>Coins:</strong> <span id="${Ie}">0</span></div>\n        <div><strong>Profit:</strong> <span id="${et}">0</span></div>\n        <div><strong>Won:</strong> <span id="${Me}">0</span></div>\n        <div><strong>Sold:</strong> <span id="${Ee}">0</span></div>\n        <div><strong>Unsold:</strong> <span id="${De}">0</span></div>\n        <div><strong>Available:</strong> <span id="${Fe}">0</span></div>\n        <div><strong>Active transfers:</strong> <span id="${Ne}">0</span></div>\n        <div><strong>Countdown:</strong> <span id="${yt}">—</span></div>\n      </div>\n\n      <div class="mb-card">\n        <h3>Progress</h3>\n        <div class="progress">\n          <div id="${_e}" class="progress-bar" style="width:0%"></div>\n        </div>\n        <div class="progress">\n          <div id="${Be}" class="progress-bar" style="width:0%"></div>\n        </div>\n      </div>\n\n      <div class="mb-card">\n        <h3>Filters</h3>\n        <select id="${E}">\n          <option value="">— Select Filter —</option>\n        </select>\n      </div>\n\n      <div class="mb-card mb-logs">\n        <h3>Logs</h3>\n        <div id="${ge}" class="mb-logbox"></div>\n      </div>\n    </div>\n  </div>\n  `,function(){const e=e=>document.getElementById(e);e("mb-start").onclick=()=>window.postMessage({type:"MAGIC_BUYER_PAGE_COMMAND",id:"start1",payload:{command:"start"}},"*"),e("mb-resume").onclick=()=>window.postMessage({type:"MAGIC_BUYER_PAGE_COMMAND",id:"resume1",payload:{command:"resume"}},"*"),e("mb-pause").onclick=()=>window.postMessage({type:"MAGIC_BUYER_PAGE_COMMAND",id:"pause1",payload:{command:"pause"}},"*"),e("mb-stop").onclick=()=>window.postMessage({type:"MAGIC_BUYER_PAGE_COMMAND",id:"stop1",payload:{command:"stop"}},"*"),e("mb-clear").onclick=()=>ni()}(),d("AutoBuyerInstance",window)}function ms(){!function(){if(document.getElementById("mb-styles"))return;const e=document.createElement("style");e.id="mb-styles",e.textContent='\n    .mb-wrap { padding: 16px; }\n    .mb-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; }\n    .mb-controls .btn { margin-right:8px; }\n    .mb-grid { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }\n    .mb-card { background:#111; color:#eee; padding:12px; border-radius:8px; }\n    .progress { background:#333; height:10px; border-radius:6px; overflow:hidden; margin:8px 0; }\n    .progress-bar { background:#2aa; height:10px; transition:width .3s ease; }\n    .mb-logs { grid-column: 1 / span 2; }\n    .mb-logbox { background:#000; min-height:160px; border:1px solid #333; padding:8px; overflow:auto; }\n    .ut-tab-bar-item[data-mb-tab="true"] { cursor:pointer; }\n  ',document.head.appendChild(e)}(),us();setInterval(()=>{try{!function(){const e=document.querySelector(".ut-tab-bar");if(!e||e.querySelector('[data-mb-tab="true"]'))return;const t=document.createElement("a");t.className="ut-tab-bar-item",t.setAttribute("role","button"),t.setAttribute("data-mb-tab","true"),t.textContent="MagicBuyer",t.addEventListener("click",ps),e.appendChild(t)}()}catch{}},800)}document.addEventListener("DOMContentLoaded",()=>{document.getElementById("btn-settings")?.addEventListener("click",()=>{chrome.tabs.query({active:!0,currentWindow:!0},e=>{e?.length&&chrome.tabs.sendMessage(e[0].id,{type:"MB_OPEN_SETTINGS"})})})}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",ms):ms()})();
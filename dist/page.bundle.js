(()=>{"use strict";var e={d:(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{idAbActiveTransfers:()=>Ue,idAbAddBuyDelay:()=>ne,idAbAddFilterGK:()=>oe,idAbAvailableItems:()=>Re,idAbBidExact:()=>V,idAbBidFutBin:()=>bt,idAbBuyPrice:()=>U,idAbCardCount:()=>L,idAbCloseTabToggle:()=>re,idAbCoins:()=>Me,idAbCountDown:()=>St,idAbCustomDiscordNameNotificationToggle:()=>le,idAbCycleAmount:()=>z,idAbDelayToAdd:()=>se,idAbDontMoveWon:()=>ht,idAbDownloadFilter:()=>et,idAbDownloadStats:()=>wt,idAbFiltersFileToUpload:()=>ct,idAbFiltersToUpload:()=>tt,idAbIgnoreAllowToggle:()=>pt,idAbItemExpiring:()=>O,idAbMaxBid:()=>k,idAbMaxPurchases:()=>Et,idAbMaxRating:()=>K,idAbMaxSearchPage:()=>ie,idAbMessageNotificationToggle:()=>ae,idAbMinDeleteCount:()=>j,idAbMinRating:()=>X,idAbNumberFilterSearch:()=>Le,idAbOverSearchWarning:()=>Dt,idAbPauseFor:()=>q,idAbProfit:()=>it,idAbRandMinBidInput:()=>Q,idAbRandMinBidToggle:()=>te,idAbRandMinBuyInput:()=>Z,idAbRandMinBuyToggle:()=>ee,idAbReportProblem:()=>vt,idAbRequestCount:()=>xe,idAbResumeAfterErrorOccured:()=>yt,idAbSearchProgress:()=>Be,idAbSearchResult:()=>W,idAbSellPrice:()=>H,idAbSellToggle:()=>G,idAbSendListingNotificationToggle:()=>ce,idAbShouldSort:()=>Ct,idAbSoldItems:()=>Fe,idAbSolveCaptcha:()=>Pe,idAbSortBy:()=>$t,idAbSortOrder:()=>At,idAbSoundToggle:()=>de,idAbStatisticsProgress:()=>Ie,idAbStatus:()=>Ee,idAbStopAfter:()=>Y,idAbStopErrorCode:()=>ke,idAbStopErrorCodeCount:()=>We,idAbToggleRunner:()=>gt,idAbUnsoldItems:()=>Ne,idAbUploadBtn:()=>dt,idAbUploadFilter:()=>Ze,idAbUseFutWiz:()=>Ft,idAbWaitTime:()=>J,idAddIgnorePlayers:()=>ot,idAddIgnorePlayersList:()=>at,idAntiCaptchKey:()=>ze,idAutoClearExpired:()=>ut,idAutoClearLog:()=>Ye,idBtnActions:()=>Tt,idBtnReport:()=>Pt,idBuyFutBinPercent:()=>ft,idBuyFutBinPrice:()=>mt,idCalcBinPrice:()=>$e,idCapatchaMp3:()=>He,idClearLogButton:()=>we,idDeleteFilter:()=>Te,idDiscordChannelId:()=>ge,idDiscordToken:()=>fe,idFUTMarketAlertToken:()=>be,idFilterDropdown:()=>F,idFilterDropdownHeader:()=>N,idFinishMp3:()=>xt,idFutBinDuration:()=>lt,idInfoWrapper:()=>ve,idLog:()=>Mt,idNotificationType:()=>me,idPreserveChanges:()=>Se,idProgressAutobuyer:()=>he,idProxyAddress:()=>je,idProxyLogin:()=>Je,idProxyPassword:()=>qe,idProxyPort:()=>Ge,idRemoveIgnorePlayers:()=>rt,idRunFilterSequential:()=>st,idSearchCancelButton:()=>ye,idSearchWrapper:()=>Oe,idSelectFilterCount:()=>Ce,idSelectedFilter:()=>R,idSellAfterTax:()=>_e,idSellCheckBuyPrice:()=>nt,idSellFutBinPercent:()=>Qe,idSellFutBinPrice:()=>Ke,idSellRatingThreshold:()=>Xe,idSession:()=>Bt,idTelegramBotToken:()=>ue,idTelegramChatId:()=>pe,idTestNotification:()=>Ae,idTooltip:()=>_t,idWebHookUrl:()=>It,idWinCount:()=>De,idWinMp3:()=>Ve});var i={};e.r(i),e.d(i,{R:()=>qn,T:()=>Yn});const n="undefined"!=typeof window?window:globalThis,s=(()=>{if(n.jQuery)return n.jQuery;if(n.$)return n.$;throw new Error("MagicBuyer: jQuery is not available in the current context.")})();n.$=s,n.jQuery=s;const o="Paused",r="Stopped",a={521:"Request Rejected",512:"Request Rejected",429:"Too many request from this user",426:"Other user won the (card / bid)",461:"Other user won the (card / bid)"},l={idBuyFutBinPercent:95,idAbCardCount:1e3,idAbCardCountisDefaultValue:!0,idAbItemExpiring:"1H",idAbItemExpiringisDefaultValue:!0,idAbSearchResult:21,idAbSearchResultisDefaultValue:!0,idSellFutBinPercent:"105-110",idFutBinDuration:"1H",idFutBinDurationisDefaultValue:!0,idAbMinDeleteCount:10,idSellRatingThreshold:100,idSellRatingThresholdisDefaultValue:!0,idAbMinRating:10,idAbMinRatingisDefaultValue:!0,idAbMaxRating:100,idAbMaxRatingisDefaultValue:!0,idAbMaxSearchPage:5,idAbMaxSearchPageisDefaultValue:!0,idAbRandMinBidInput:300,idAbRandMinBidInputisDefaultValue:!0,idAbRandMinBuyInput:300,idAbRandMinBuyInputisDefaultValue:!0,idBuyFutBinPrice:!0,idSellFutBinPrice:!0,idSellCheckBuyPrice:!0,idAbSellToggle:!1,idAbRandMinBidToggle:!0},c={idAbAddBuyDelay:!0,idAbCycleAmount:"15-20",idAbDelayToAdd:"3S",idAbMaxPurchases:1,idAbNumberFilterSearch:3,idAbNumberFilterSearchisDefaultValue:!0,idAbPauseFor:"15-30S",idAbSoundToggle:!0,idAbStopAfter:"1-2H",idAbStopErrorCodeCount:3,idAbWaitTime:"5-8",idAbWaitTimeisDefaultValue:!1,idAutoClearExpired:!0,idAutoClearLog:!0},d=!!window.ReactNativeWebView,u=new Map,p=(e,t)=>{u.set(e,t)},m=e=>{const t=u.get(e);return t&&t.expiryTimeStamp&&t.expiryTimeStamp<Date.now()?(u.delete(e),null):t},f=(e=!1)=>{const t=m("BuyerSettings")||{};if(e)return t;const i=m("CommonSettings")||{};return Object.assign({},t,i)},g=e=>{let t=m(e)||0;return t++,p(e,t),t},b=()=>((m("CommonSettings")||{}).idAbUseFutWiz?"futwiz":"futbin").toUpperCase(),h=e=>{let t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var n=0;n<e;n++)t+=i.charAt(Math.floor(62*Math.random()));return t},y=async(e=1)=>{const t=Math.floor(Math.random());await new Promise(i=>setTimeout(i,1e3*(t+e)))},v=(e,t)=>{window.ReactNativeWebView.postMessage(JSON.stringify({type:"downloadFile",payload:{data:JSON.stringify(e,null,4),fileName:t}}))},S=(e,t)=>{window.ReactNativeWebView.postMessage(JSON.stringify({type:"downloadFile",payload:{data:e,fileName:t}}))},w=(e,t)=>{const i="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e,null,4)),n=document.createElement("a");n.setAttribute("href",i),n.setAttribute("download",`${t}.json`),document.body.appendChild(n),n.click(),document.body.removeChild(n)},A=(e,t)=>{const i="data:text/csv;charset=utf-8,%EF%BB%BF"+encodeURIComponent(e),n=document.createElement("a");n.setAttribute("href",i),n.setAttribute("download",`${t}.csv`),document.body.appendChild(n),n.click(),document.body.removeChild(n)},C=e=>{if(e){let t=(e+="")[e.length-1].toUpperCase(),i=P(e.substring(0,e.length-1))/1e3;return i&&(i*="M"===t?60:"H"===t?3600:1),i}return 0},T=e=>{const t=I(e);return t.length>=2?B(t[0],t[1]):t[0]||0},P=e=>{if(e){const[t,i]=e.split("-").map(e=>parseInt(e));return 1e3*Math.round(Math.random()*(i-t)+t)}return 0},_=e=>{if(e){let t=e[e.length-1].toUpperCase(),i=parseInt(e.substring(0,e.length-1));return i&&(i*="M"===t?60:"H"===t?3600:1),i}return 0},B=(e,t)=>Math.round(Math.random()*(t-e)+e),I=e=>e?(e+"").split("-").map(e=>parseInt(e)):[],x=(e,t)=>(e.length<=t&&(e+=" ".repeat(t-e.length)),e),M=function(e){const t=f();if(!d&&t.idAbSoundToggle){let t=document.getElementById(Ve);"capatcha"==e?t=document.getElementById(He):"finish"==e?t=document.getElementById(xt):"cardWon"==e&&(t=document.getElementById(Ve)),t.currentTime=0,t.play()}},D=function(e){if(!e)return 0;var t=(new Date).getTime();return Math.max(0,e.end-t)/(e.end-e.start)*100},E=function(e){for(let i of Object.keys(e)){const n=e[i];if(e[i+"isDefaultValue"])continue;const s=`#${t[i]}`;if("boolean"==typeof n){if(n){$(s).addClass("toggled");continue}$(s).removeClass("toggled")}else $(s).val(n)}},F="elem_"+h(15),N="elem_"+h(15),R="elem_"+h(15),U="elem_"+h(15),L="elem_"+h(15),k="elem_"+h(15),W="elem_"+h(15),O="elem_"+h(15),V="elem_"+h(15),H="elem_"+h(15),j="elem_"+h(15),G="elem_"+h(15),J="elem_"+h(15),z="elem_"+h(15),q="elem_"+h(15),Y="elem_"+h(15),X="elem_"+h(15),K="elem_"+h(15),Q="elem_"+h(15),Z="elem_"+h(15),ee="elem_"+h(15),te="elem_"+h(15),ie="elem_"+h(15),ne="elem_"+h(15),se="elem_"+h(15),oe="elem_"+h(15),re="elem_"+h(15),ae="elem_"+h(15),le="elem_"+h(15),ce="elem_"+h(15),de="elem_"+h(15),ue="elem_"+h(15),pe="elem_"+h(15),me="elem_"+h(15),fe="elem_"+h(15),ge="elem_"+h(15),be="elem_"+h(15),he="elem_"+h(15),ye="elem_"+h(15),ve="elem_"+h(15),Se="elem_"+h(15),we="elem_"+h(15),$e="elem_"+h(15),Ae="elem_"+h(15),Ce="elem_"+h(15),Te="elem_"+h(15),Pe="elem_"+h(15),_e="elem_"+h(15),Be="elem_"+h(15),Ie="elem_"+h(15),xe="elem_"+h(15),Me="elem_"+h(15),De="elem_"+h(15),Ee="elem_"+h(15),Fe="elem_"+h(15),Ne="elem_"+h(15),Re="elem_"+h(15),Ue="elem_"+h(15),Le="elem_"+h(15),ke="elem_"+h(15),We="elem_"+h(15),Oe="elem_"+h(15),Ve="elem_"+h(15),He="elem_"+h(15),je="elem_"+h(15),Ge="elem_"+h(15),Je="elem_"+h(15),ze="elem_"+h(15),qe="elem_"+h(15),Ye="elem_"+h(15),Xe="elem_"+h(15),Ke="elem_"+h(15),Qe="elem_"+h(15),Ze="elem_"+h(15),et="elem_"+h(15),tt="elem_"+h(15),it="elem_"+h(15),nt="elem_"+h(15),st="elem_"+h(15),ot="elem_"+h(15),rt="elem_"+h(15),at="elem_"+h(15),lt="elem_"+h(15),ct="elem_"+h(15),dt="elem_"+h(15),ut="elem_"+h(15),pt="elem_"+h(15),mt="elem_"+h(15),ft="elem_"+h(15),gt="elem_"+h(15),bt="elem_"+h(15),ht="elem_"+h(15),yt="elem_"+h(15),vt="elem_"+h(15),St="elem_"+h(15),wt="elem_"+h(15),$t="elem_"+h(15),At="elem_"+h(15),Ct="elem_"+h(15),Tt="elem_"+h(15),Pt="elem_"+h(15),_t="elem_"+h(15),Bt=h(15),It="elem_"+h(15),xt="elem_"+h(15),Mt="elem_"+h(15),Dt="elem_"+h(15),Et="elem_"+h(15),Ft="elem_"+h(15);p("sessionStats",{soldItems:"-",unsoldItems:"-",activeTransfers:"-",availableItems:"-",coins:"-",winCount:0,coinsNumber:0,previousPause:0,searchCount:0,profit:0,transactions:[],searchPerMinuteCount:0});const Nt=()=>{const e=D(m("searchInterval")),t=m("sessionStats");$("#"+xe).html(t.searchCount),$("#"+it).html(t.profit),$("#"+Me).html(t.coins),$("#"+De).html(t.winCount),$("#"+Be).css("width",e),Ut()},Rt=()=>{const e=D(m("searchInterval")),t=m("sessionStats");$("#"+Be).css("width",e),$("#"+Ie).css("width",e),$("#"+Me).html(t.coins),$("#"+De).html(t.winCount),$("#"+xe).html(t.searchCount),$("#"+Fe).html(t.soldItems),$("#"+Ne).html(t.unsoldItems),$("#"+Re).html(t.availableItems),$("#"+Ue).html(t.activeTransfers),$("#"+it).html(t.profit),Ut(),t.unsoldItems?$("#"+Ne).css("color","red"):$("#"+Ne).css("color",""),t.availableItems?$("#"+Re).css("color","orange"):$("#"+Re).css("color","")},Ut=()=>{const e=m("botStartTime");if(e&&m("autoBuyerActive")){const t=Math.abs(new Date-e)/1e3,i=Math.floor(t/60/60%24),n=Math.floor(t/60%60),s=Math.floor(t%60),o=(i<10?"0":"")+i+":"+(n<10?"0":"")+n+":"+(s<10?"0":"")+s;$("#"+St).html(o),Lt("runningTime",o)}},Lt=(e,t)=>{const i=m("sessionStats");i[e]=t,p("sessionStats",i)},kt=e=>m("sessionStats")[e]||0,Wt=function(e,t,i){const n=new UTStandardButtonControl;if(n.init(),n.addTarget(n,t,EventType.TAP),n.setText(e),i){const e=i.split(" ");for(let t of e)n.getRootElement().classList.add(t)}return n},Ot=()=>{const e=$(`<div style=${isPhone()?"height: 90%;display: flex;flex-direction: column;padding: 7px;":"width:48%"} id=${Mt}>\n            <div class="logs-container">\n              <div data-title="Clear logs" class="button-clear">\n              </div>\n            </div>\n            <br/>\n            <div class="logWrapper">\n            <ul wrap="off"  style="height: 100%;overflow-x: auto;resize: none; width: 100%;" id=${he} class="autoBuyerLog"></ul>\n            <br/>\n        </div>`);return e.find(".button-clear").append(Wt("⎚",()=>nn()).__root),e},Vt=()=>{$("#"+he).empty()};let Ht=new Set;const jt=(e,t,i,n,s=!1)=>{const o=m(t)||{};"number"===n&&(i=parseInt(i)),o[e]=i||null,o[e+"isDefaultValue"]=s,p(t,o)},Gt=(e,t,i,n,s,o="number",r=".*",a="buyer-settings-field",l=null)=>{const c=Object.keys(i)[0];return t&&(l&&l(t),jt(c,s,t,o,!0)),Ht.has(c)||($(document).on("input",`#${i[c]}`,({target:{value:e}})=>{l&&l(e),jt(c,s,e||t,o,!e)}),Ht.add(c)),`<div class="price-filter ${a}">\n       <div class="info">\n           <span class="secondary label">${e} :<br/><small>${n}</small></span>\n       </div>\n       <div class="buttonInfo">\n           <div class="inputBox">\n               <input pattern="${r}" type="${o}" class="numericInput" id='${i[c]}' placeholder=${t}>\n           </div>\n       </div>\n    </div>`};let Jt=new Set;const zt=(e,t,i,n,s="buyer-settings-field",o=null)=>{const r=Object.keys(t)[0];return Jt.has(r)||($(document).on("click touchend",`#${t[r]}`,e=>{!o&&((e,t,i)=>{const n=m(t)||{};n[e]?(n[e]=!1,$(i.currentTarget).removeClass("toggled")):(n[e]=!0,$(i.currentTarget).addClass("toggled")),p(t,n)})(r,n,e),o&&o(e)}),Jt.add(r)),`\n    <div class="price-filter  ${s}">\n        <div class="ut-toggle-cell-view">\n           <span class="ut-toggle-cell-view--label">${e} <br/><small>${i}</small></span>\n             <div id='${t[r]}' class="ut-toggle-control">\n               <div class="ut-toggle-control--track">\n              </div>\n              <div class= "ut-toggle-control--grip" >\n          </div> \n           </div> \n       </div>\n    </div> `},qt=function(){const e=b();return`<div class='buyer-settings-wrapper buy-settings-view'>\n      ${zt("Find Buy Price",{idBuyFutBinPrice:mt},`(Uses ${e} price for Buy)`,"BuyerSettings")}\n      ${Gt("Buy/Bid Price Percent",100,{idBuyFutBinPercent:ft},`(Buy/Bid Price percent of ${e} Price)`,"BuyerSettings")}\n      ${zt(`Bid For ${e} Price`,{idAbBidFutBin:bt},`(Bid if the current bid is lesser than ${e} Price)`,"BuyerSettings")}\n      ${Gt("Buy Price","",{idAbBuyPrice:U},"<br/>","BuyerSettings")}\n      ${Gt("No. of cards to buy",1e3,{idAbCardCount:L},"(Works only with Buy price)","BuyerSettings")}\n      ${Gt("Bid Price","",{idAbMaxBid:k},"<br/>","BuyerSettings")}\n      ${Gt("Bid items expiring in","1H",{idAbItemExpiring:O},"(S for seconds, M for Minutes, H for hours)","BuyerSettings","text","\\d+[H|M|S|h|m|s]$")} \n      ${Gt("Search result threshold",21,{idAbSearchResult:W},"(Buy or bid cards only if the no.of search results is lesser than the specified value)","BuyerSettings")}\n      ${zt("Bid Exact Price",{idAbBidExact:V},"","BuyerSettings")}      \n     </div>\n    `};$(document).on("keyup","#"+H,function({target:{value:e}}){Yt(e)});const Yt=e=>{const t=parseInt(e);if(isNaN(t))return void $("#"+_e).html(0);const i=(e-e/100*5).toLocaleString();$("#"+_e).html(i)},Xt=function(){const e=b();return`<div style='display : none' class='buyer-settings-wrapper sell-settings-view'>\n  ${zt("Find Sale Price",{idSellFutBinPrice:Ke},`(Uses ${e} price for listing)`,"BuyerSettings")}\n  ${Gt("Sell Price Percent","100-100",{idSellFutBinPercent:Qe},`(Sale Price percent of ${e} Price)`,"BuyerSettings","text","\\d+-\\d+$")}\n  ${zt("Check buy price before listing",{idSellCheckBuyPrice:nt},"(List only if Buy Price is lesser than Sale Price)","BuyerSettings")}\n  ${Gt("Sell Price","",{idAbSellPrice:H},`(-1 to send to transferlist)<br />Receive After Tax: <span id=${_e}>0</span>`,"BuyerSettings")} \n   ${Gt("List Duration","1H",{idFutBinDuration:lt},"List Duration when listing","BuyerSettings","text","\\d+[H|M|S|h|m|s]$")}\n  ${Gt("Clear sold count",10,{idAbMinDeleteCount:j},"(Clear sold items when reach a specified count)","BuyerSettings")}\n  ${Gt("Rating Threshold",100,{idSellRatingThreshold:Xe},"(Rating threshold to list the sniped player)","BuyerSettings")}\n  ${zt("Relist Unsold Items",{idAbSellToggle:G},"","BuyerSettings")}\n  ${zt("Dont move won items",{idAbDontMoveWon:ht},"(Keep won items in Unassigned or Transfer Targets)","BuyerSettings")}\n  </div>`},Kt=function(){return`<div style='display : none' class='buyer-settings-wrapper safety-settings-view'>\n  ${Gt("Wait Time","7-15",{idAbWaitTime:J},"(Random second range eg. 7-15)","CommonSettings","text","\\d+-\\d+$")}\n  ${Gt("Max purchases per search request",1,{idAbMaxPurchases:Et},"Increase this, only if you are Adding Delay After Buy of alteast 3S","CommonSettings")}\n  ${Gt("Pause Cycle","10-15",{idAbCycleAmount:z},"(No. of searches performed before triggering Pause eg. 10-15)","CommonSettings","text","\\d+-\\d+$")}\n  ${Gt("Pause For","5-8S",{idAbPauseFor:q},"(S for seconds, M for Minutes, H for hours eg. 0-0S)","CommonSettings","text","\\d+-\\d+[H|M|S|h|m|s]$")}\n  ${zt("Add Delay After Buy",{idAbAddBuyDelay:ne},"(Adds Delay after trying to buy / bid a card)","CommonSettings")}\n  ${Gt("Delay To Add","1S",{idAbDelayToAdd:se},"(S for seconds, M for Minutes, H for hours)","CommonSettings","text","\\d+[H|M|S|h|m|s]$")}\n  ${Gt("Stop After","3-4H",{idAbStopAfter:Y},"(S for seconds, M for Minutes, H for hours  eg. 3-4H)","CommonSettings","text","\\d+-\\d+[H|M|S|h|m|s]$")}\n  ${zt("Show Search Exceed Warning",{idAbOverSearchWarning:Dt},"(Shows a warning in log if number of search per minute exceeds 15)","CommonSettings")} \n  </div>`},Qt=function(){return`<div style='display : none' class='buyer-settings-wrapper captcha-settings-view'>\n    ${zt("Close Web App on Captcha Trigger",{idAbCloseTabToggle:re},"","CommonSettings")}         \n    ${zt("Auto Solve Captcha",{idAbSolveCaptcha:Pe},"","CommonSettings")}\n    ${Gt("Anti-Captcha Key","",{idAntiCaptchKey:ze},"","CommonSettings","text")}\n    ${Gt("Proxy Address","",{idProxyAddress:je},"","CommonSettings","text")}\n    ${Gt("Proxy Port","",{idProxyPort:Ge},"","CommonSettings")}\n    ${Gt("Proxy User Name (Optional)","",{idProxyLogin:Je},"","CommonSettings","text")}\n    ${Gt("Proxy User Password (Optional)","",{idProxyPassword:qe},"","CommonSettings","text")} \n    `};let Zt=new Set;const ei=(e,t,i,n)=>(Zt.has(e)||(ti(e,i),Zt.add(e)),`<button class="btn-standard ${n}" id="${e}">${t}</button>`),ti=(e,t)=>{$(document).on({mouseenter:function(){$(this).addClass("hover")},mouseleave:function(){$(this).removeClass("hover")},click:function(){t()},touchenter:function(){$(this).addClass("hover")},touchleave:function(){$(this).removeClass("hover")},touchend:function(){t()}},`#${e}`)},ii=function(){return`<div style='display : none' class='buyer-settings-wrapper notification-settings-view'> \n ${d?"":`${Gt("Telegram Bot Token","",{idTelegramBotToken:ue},"Token of your own bot","CommonSettings","text")}\n  ${Gt("Telegram Chat ID","",{idTelegramChatId:pe},"Your Telegram ChatID","CommonSettings","text")}\n  ${Gt("Discord Bot Token","",{idDiscordToken:fe},"Your Discord Bot Token","CommonSettings","text")}\n  ${Gt("Discord Channel ID","",{idDiscordChannelId:ge},"Your Discord Channel ID","CommonSettings","text")}\n  ${Gt("Discord WebHook Url","",{idWebHookUrl:It},"Your Discord Channel Webhook Url","CommonSettings","text")}\n  ${Gt("Fut Market Alert Notification Token","",{idFUTMarketAlertToken:be},"Your FUT Market Alert App's Token","CommonSettings","text")}\n  ${zt("Send Listing Notification",{idAbSendListingNotificationToggle:ce},"","CommonSettings")}`}\n  ${Gt("Notification Type","",{idNotificationType:me},"Type A for all notifications, B for buy or L for lost","CommonSettings","text","[A|B|L]$")}\n  ${zt("Send Notification",{idAbMessageNotificationToggle:ae},"","CommonSettings")}\n   ${d?"":`${zt("Sound Notification",{idAbSoundToggle:de},"","CommonSettings")}\n  <audio id='${Ve}' hidden>\n    <source src="https://notificationsounds.com/storage/sounds/file-sounds-869-coins.ogg" type="audio/ogg">\n    <source src="https://notificationsounds.com/storage/sounds/file-sounds-869-coins.mp3" type="audio/mpeg">\n      "Your browser does not support the audio element"\n  </audio>\n  <audio id='${He}' hidden>\n    <source src="https://notificationsounds.com/storage/sounds/file-sounds-897-alarm-frenzy.ogg" type="audio/ogg">\n    <source src="https://notificationsounds.com/storage/sounds/file-sounds-897-alarm-frenzy.mp3" type="audio/mpeg">\n      "Your browser does not support the audio element"\n  </audio>\n  <audio id='${xt}' hidden>\n    <source src="https://freesound.org/data/previews/220/220763_4104696-lq.ogg" type="audio/ogg">\n    <source src="https://freesound.org/data/previews/220/220763_4104696-lq.mp3" type="audio/mpeg">\n      "Your browser does not support the audio element"\n  </audio> `}\n     ${zt("Use Custom Discord Webhook Name",{idAbCustomDiscordNameNotificationToggle:le},"","CommonSettings")}\n   <div class="btn-test-notification buyer-settings-field">\n   ${ei(Ae,"Test Notification",()=>ji("Test Notification Message",!0,!0),"call-to-action")}\n   </div>\n  `},ni=function(){return`<div style='display : none' class='buyer-settings-wrapper common-settings-view'>\n  ${Gt("Error Codes to stop bot (csv)","",{idAbStopErrorCode:ke},"(Eg. 412,421,521)","CommonSettings","text","^\\d+(,\\d+)*$")}\n  ${Gt("No. of times error code should occur",3,{idAbStopErrorCodeCount:We},"<br />","CommonSettings")}\n  ${Gt("Resume bot after","",{idAbResumeAfterErrorOccured:yt},"(S for seconds, M for Minutes, H for hours eg. 0-0S)","CommonSettings","text","\\d+-\\d+[H|M|S|h|m|s]$")}\n  ${zt("Auto Clear Log",{idAutoClearLog:Ye},"(Automatically clear logs every 2 minutes)","CommonSettings")}\n  ${zt("Auto Clear Expired Items",{idAutoClearExpired:ut},"(Automatically clear expired items from transfer targets)","CommonSettings")}\n  ${zt("Use Futwiz Price",{idAbUseFutWiz:Ft},"(Uses Futwiz price for buying/selling cards)","CommonSettings")}\n  </div>`},si=function(e,t){let i=!1;return $(`${e} option`).each(function(){if(this.value===t)return i=!0,!1}),i||$(e).append($("<option></option>").attr("value",t).text(t)),i},oi=function(){const e=$(`#${R}`).val()||[];e.length?p("selectedFilters",e):p("selectedFilters",[])};let ri;$(document).on({change:()=>{const e=$(`#${$t}`).val()||"buy",t=m("BuyerSettings")||{};t.idAbSortBy=e,p("BuyerSettings",t)}},`#${$t}`);const ai=function(){if("function"!=typeof UTPlayerSearchControl)return $('<div class="price-filter buyer-settings-field">\n        <div class="info">\n          <span class="secondary label">\n            Players List :<br/>\n            <small>Player search is unavailable. Open the MagicBuyer tab in the web app first.</small>\n          </span>\n        </div>\n      </div>');ri=new UTPlayerSearchControl;const e=`#${at}`,t=$(`\n            <div class="price-filter buyer-settings-field">\n              <div class="info">\n               <span class="secondary label">\n                  <button id=${_t} style="font-size:16px" class="flat camel-case">Players List</button><br/>\n                </span>\n              </div>\n              <div class="ignore-players displayCenterFlx">\n                ${ei(ot,"+",()=>{const t=`${ri._playerNameInput.value}(${ri.selected.rating})`,i=si(e,t);if($(`${e} option[value="${t}"]`).attr("selected",!0),!i){const e=m("BuyerSettings")||{},i=e.idAddIgnorePlayersList||[];i.push({id:ri.selected.id,displayName:t}),e.idAddIgnorePlayersList=i,p("BuyerSettings",e)}},"btn-standard filterSync action-icons")}                \n                </div>\n              </div>\n              <div class="price-filter buyer-settings-field">\n                <div class="info">\n                <span class="secondary label">\n                  <button id=${_t} style="font-size:16px" class="flat camel-case">Remove from Players List</button><br/>\n                </span>\n                </div>\n                <div class="displayCenterFlx">\n                  <select style="width:90%;height: 3rem;font-size: 1.5rem;" class="filter-header-settings" id=${at}>\n                    <option selected="true" disabled>Players List</option>                            \n                  </select>\n                  ${ei(rt,"❌",()=>{const t=$(`${e} option`).filter(":selected").val();if("Ignored Players List"!=t){$(`${e} option[value="${t}"]`).remove(),$(`${e}`).prop("selectedIndex",0);const i=m("BuyerSettings")||{};let n=i.idAddIgnorePlayersList||[];n=n.filter(({displayName:e})=>e!=t),i.idAddIgnorePlayersList=n,p("BuyerSettings",i)}},"btn-standard filterSync font15 action-icons")}\n                </div>\n              </div>              \n              `);return ri&&($(ri.__root).insertBefore(t.find(`#${ot}`)),ri.init(),ri._playerNameInput.setPlaceholder("Search Players")),t},li=function(){const e=$(`<div style='display : none' class='buyer-settings-wrapper results-filter-view'>\n    <div class="place-holder">\n    </div>\n    ${zt("Ignore/Buy Players List",{idAbIgnoreAllowToggle:pt},"(If toggled bot will only buy/bid the above players else bot will ignore the players when bidding/buying )","BuyerSettings")}\n    ${Gt("Min Rating",10,{idAbMinRating:X},"Minimum Player Rating","BuyerSettings")}\n    ${Gt("Max Rating",100,{idAbMaxRating:K},"Maximum Player Rating","BuyerSettings")}    \n    ${Gt("Search result page limit",5,{idAbMaxSearchPage:ie},"No of. pages bot should move forward before going back to page 1","BuyerSettings")}\n    ${Gt("Max value of random min bid",300,{idAbRandMinBidInput:Q},"","BuyerSettings")}\n    ${zt("Use random min bid",{idAbRandMinBidToggle:te},"","BuyerSettings")}\n    ${Gt("Max value of random min buy",300,{idAbRandMinBuyInput:Z},"","BuyerSettings")}\n    ${zt("Use random min buy",{idAbRandMinBuyToggle:ee},"","BuyerSettings")}\n    ${zt("SKIP GK",{idAbAddFilterGK:oe},"(Skip all goalkeepers to buy / bid a card)","BuyerSettings")}\n    ${zt("Sort players",{idAbShouldSort:Ct},"","BuyerSettings")}\n    <div class="price-filter buyer-settings-field">\n      <div class="displayCenterFlx">\n      <select style="width:95%;height: 3rem;font-size: 1.5rem;" class="select-sortBy filter-header-settings" id="${$t}">\n        <option disabled selected>--Select Sort Attribute--</option>\n        <option value="expires">Expires on</option>          \n        <option value="buy">Buy now price</option>\n        <option value="bid">Bid now price</option>\n        <option value="rating">Player rating</option>\n      </select>\n      </div>\n    </div>\n    ${zt("Order",{idAbSortOrder:At},"(Enabled = descending, Disabled = ascending)","BuyerSettings")}\n  </div>`),t=e.find(".place-holder");return ai().insertAfter(t),e};let ci;const di=e=>new Promise((t,i)=>{const n=ci.transaction("Filters","readwrite");n.objectStore("Filters").delete(e),n.oncomplete=function(){t()},n.onerror=function(){i()}}),ui=(e,t,i="Filters")=>new Promise((n,s)=>{const o=ci.transaction(i,"readwrite");o.objectStore(i).put({filterName:e,jsonData:t}),o.oncomplete=function(){n()},o.onerror=function(){s()}}),pi=(e="Filters")=>new Promise((t,i)=>{const n=ci.transaction(e,"readonly").objectStore(e).getAll();n.onsuccess=function(){const e={};if(n.result.length)for(let t=0;t<n.result.length;t++)e[n.result[t].filterName]=n.result[t].jsonData;t(e)},n.onerror=function(){i()}}),mi=(e="Filters")=>pi(e),fi=(e,t,i="Filters")=>ui(e,t,i),gi=(e,t,i,n)=>{const s=new EADialogViewController({dialogOptions:e,message:i,title:t});s.init(),s.onExit.observe(void 0,function(e,t){e.unobserve(this),n.call(this,t)}),gPopupClickShield.setActivePopup(s)};$(document).on({touchend:function(){$(`#${ct}`).trigger("click")}},`#${ct}`);const bi=e=>{const t={},i=$(`#${tt}`).val()||[];if(i.length){for(let n of i){const i=e[n],s=JSON.parse(i);t[n]=s}var n,s;n={filters:t},s="filters",d?v(n,s):w(n,s),Vi("Filters downloaded successfully")}else Vi("No filter selected",UINotificationType.NEGATIVE)},hi=()=>{const e=$(`#${ct}`).prop("files");if(!e||!e[0])return void Vi("No filter file selected",UINotificationType.NEGATIVE);const t=e[0],i=new FileReader;i.onload=e=>{const t=JSON.parse(e.target.result);if(t&&t.filters){for(let e in t.filters)Li(e,t.filters[e]);Vi("Filters uploaded successfully")}else Vi("Not a valid filters file")},i.readAsText(t)},yi=async()=>{m("filters")||p("filters",await mi()||{});let e=m("filters");return e=Object.keys(e).sort().reduce((t,i)=>(t[i]=e[i],t),{}),e};$(document).on({change:oi,click:oi,touchend:oi},`#${R}`);const vi=(e,t)=>{let i=m(t);return i?(i=!1,$(e.currentTarget).removeClass("toggled")):(i=!0,$(e.currentTarget).addClass("toggled")),p(t,i),i},Si=async function(){return m("runSequentially")&&(p("runSequentially",!1),setTimeout(()=>{$(`#${st}`).click()})),`<div style='display : none' class='buyer-settings-wrapper filter-settings-view'>\n                <div class="price-filter buyer-settings-field multiple-filter teleporter">\n                    <select  multiple="multiple" class="multiselect-filter filter-header-settings" id="${R}"\n                     name="selectedFilters" style="overflow-y : scroll;">\n                     ${Object.keys(await yi()).map(e=>`<option value='${e}'>${e}</option>`)}\n                    </select>\n                </div>\n                ${Gt("No. of search For each filter",m("fiterSearchCount")||3,{idAbNumberFilterSearch:Le},"(Count of searches performed before switching to another filter)","CommonSettings","number",null,"buyer-settings-field",e=>p("fiterSearchCount",parseInt(e)||3))}\n                ${zt("Switch filter sequentially",{idRunFilterSequential:st},"","CommonSettings","buyer-settings-field",e=>vi(e,"runSequentially"))}\n            </div>\n    `},wi=async function(e){const t=this,i=e?"transfer":"";$(document).off("change",`#${F}${i}`),$(document).on({change:function(){const n=$(`#${F}${i} option`).filter(":selected").val();ki.call(t,n,e)}},`#${F}${i}`);const n=$(`<div style="width:100%;display: flex;flex-direction: column;">\n            ${isPhone()&&!e?zt("Runner Mode",{idAbToggleRunner:gt},"","MisSettings","runner",e=>{const t=vi(e,"runnerToggle");$(".auto-buyer").toggleClass("displayNone"),t?$(".filter-place").append($(`#${R}`)):$(".teleporter").append($(`#${R}`))}):""}\n            ${e?"":`<div id=${Pt} class="btn-report"></div>`}         \n            <div class="price-filter buyer-settings-field multiple-filter filter-place">\n            </div> \n            <div class="button-container btn-filters">\n                 <select class="filter-header-settings" id='${F}${i}'>\n                    <option selected="true" disabled>Choose filter to load</option>\n                    ${e?"":'<option value="_default">_DEFAULT</option>'}  \n                    ${Object.keys(await yi()).map(e=>`<option value="${e}">${e}</option>`)}                    \n                 </select>                 \n                ${e?"":ei(Ze,"⇧",()=>{(()=>{let e=`Upload Filter Json file <br /> <br />\n  <input accept=".json" type="file" id="${ct}">\n   </input> <br /> <br /> <br />\n   Uploading filters will override filters with the same name`;gi([{labelEnum:enums.UIDialogOptions.OK},{labelEnum:enums.UIDialogOptions.CANCEL}],"Upload filters",e,e=>{2===e&&hi()})})()},"filterSync")}\n               ${e?"":ei(et,"⇩",()=>{(()=>{const e=m("filters");let t=`Choose filters to Download <br /> <br />\n  <select  multiple="multiple" class="multiselect-filter filter-header-settings" id="${tt}"\n      style="overflow-y : scroll">\n      ${Object.keys(e).map(e=>`<option value='${e}'>${e}</option>`)}\n   </select> <br /> <br /> <br />`;gi([{labelEnum:enums.UIDialogOptions.OK},{labelEnum:enums.UIDialogOptions.CANCEL}],"Download filters",t,async t=>{2===t&&await bi(e)})})()},"filterSync")}\n             </div> \n               ${e?"":`<div id=${Tt} style="margin-top: 1%;" class="button-container btn-filters"></div>`}\n             </div>`);return!e&&$i.call(this,n,t),n},$i=function(e,t){const i=e.find(`#${Tt}`),n=e.find(`#${Pt}`);i.append(Wt("Delete Filter",()=>Wi.call(t),"call-to-action btn-delete-filter").__root),i.append(Wt("Save Filter",function(){Ui.call(this,t)},"call-to-action btn-save-filter").__root),n.append(Wt("Report a problem",()=>{gi([{labelEnum:atob("RGlzY29yZA==")},{labelEnum:atob("VHdpdHRlcg==")},{labelEnum:atob("R2l0aHVi")}],atob("UmVwb3J0IGEgcHJvYmxlbQ=="),atob("QmVsb3cgYXJlIHRoZSBsaXN0IG9mIHdheXMgdG8gcmVwb3J0IGEgcHJvYmxlbSA8YnIgLz5NYWtlIHN1cmUgdG8gZ28gdGhyb3VnaCB0aGUgPGEgaHJlZj0naHR0cHM6Ly95b3V0dWJlLmNvbS9wbGF5bGlzdD9saXN0PVBMR21LTWczYVJrWGpQUjVna2x4TXlxeHRoWW9vV0k1SUMnIHRhcmdldD0nX2JsYW5rJz55b3V0dWJlIHBsYXlsaXN0PC9hPiBpZiBhbnkgc2V0dGluZ3MgYXJlIHVuY2xlYXIgPGJyIC8+"),e=>{e===atob("R2l0aHVi")?window.open(atob("aHR0cHM6Ly9naXRodWIuY29tL2NoaXRoYWt1bWFyMTMvRlVULUF1dG8tQnV5ZXIvaXNzdWVz"),atob("X2JsYW5r")):e===atob("RGlzY29yZA==")?window.open(atob("aHR0cHM6Ly9kaXNjb3JkLmNvbS9pbnZpdGUvY2t0SFltcA=="),atob("X2JsYW5r")):e===atob("VHdpdHRlcg==")&&window.open(atob("aHR0cHM6Ly90d2l0dGVyLmNvbS9BbGdvc0Nr"),atob("X2JsYW5r"))})},"call-to-action").__root)},Ai=new Map;let Ci,Ti;Ai.set(0,{label:"Buy/Bid Settings",selector:".buy-settings-view"}),Ai.set(1,{label:"Sell Settings",selector:".sell-settings-view"}),Ai.set(2,{label:"Search Settings",selector:".results-filter-view"}),Ai.set(3,{label:"Safety Settings",selector:".safety-settings-view"}),Ai.set(4,{label:"Filter Settings",selector:".filter-settings-view"}),Ai.set(5,{label:"Captcha Settings",selector:".captcha-settings-view"}),Ai.set(6,{label:"Notification Settings",selector:".notification-settings-view"}),Ai.set(7,{label:"Common Settings",selector:".common-settings-view"});const Pi=function(){return Ti=new EAFilterBarView,Ai.forEach((e,t)=>{Ti.addTab(t,e.label)}),Ti.setActiveTab(0),Ti.layoutSubviews(),p("activeSettingsTab",0),Ti.addTarget(this,Mi,EventType.TAP),Ti.__root.style="margin-top: 20px;",Ci=$(Ti.__root),Ci.find(".menu-container").css("overflow-x","auto"),Ii(!0),Ti},_i=async function(){xi(),Ei(),await Ii();const e=m("AutoBuyerInstance");UTMarketSearchFiltersViewController.prototype._eResetSelected.call(e)},Bi=async e=>{let t=await mi("CommonSettings");if(t=JSON.parse(t.CommonSettings||"{}"),!$.isEmptyObject(t)){const i=e?m("CommonSettings"):{};p("CommonSettings",Object.assign({},i,t))}},Ii=async function(e){Ti.setActiveTab(0),p("activeSettingsTab",0),Ci.append(qt.call(this)),Ci.append(Xt.call(this)),Ci.append(li.call(this)),Ci.append(Kt.call(this));const t=await Si.call(this);Ci.append(t),Ci.append(Qt.call(this)),Ci.append(ii.call(this)),Ci.append(ni.call(this)),$(".menu-container").animate({scrollLeft:0}),setTimeout(async()=>{const t=m("selectedFilters")||[],{idAbSortBy:i}=m("BuyerSettings")||{};i&&$(`${$t} option[value='${i}']`).prop("selected","selected"),$.each(t,function(e,t){$(".multiselect-filter option[value='"+t+"']").prop("selected","selected")}),e&&await Bi()})},xi=()=>{Ai.forEach((e,t)=>{$(e.selector).remove()}),ri&&"function"==typeof ri.destroy&&ri.destroy(),ri=null},Mi=function(e,t,i){Di(),p("activeSettingsTab",i.index);const n=Ai.get(i.index).selector;$(n).css("display","")},Di=()=>{Ai.forEach((e,t)=>{$(e.selector).css("display","none")})},Ei=()=>{p("currentFilter",null),p("BuyerSettings",{}),p("currentFilter",{})},Fi=()=>{document.querySelectorAll(":invalid").length&&Vi("Settings with invalid value found, fix these values for autobuyer to work as intended",UINotificationType.NEGATIVE)},Ni=`#${F}`,Ri=`#${R}`,Ui=function(e){const t=this;$(t).addClass("active");let i=f(!0),n=m("CommonSettings");setTimeout(function(){let s={};const o=e._viewmodel;s.searchCriteria={criteria:o.searchCriteria,playerData:o.playerData,buyerSettings:i};let r=$(`${Ni} option`).filter(":selected").val();"Choose filter to load"===r&&(r=void 0);let a=prompt("Enter a name for this filter",r);if(Fi(),a){if("_DEFAULT"===a.toLocaleUpperCase())return Vi("Cannot override _DEFAULT filter",UINotificationType.NEGATIVE);Li(a,s),fi("CommonSettings",JSON.stringify(n),"CommonSettings"),p("currentFilter",a),$(t).removeClass("active"),Vi("Changes saved successfully")}else $(t).removeClass("active"),Vi("Filter Name Required",UINotificationType.NEGATIVE)},200)},Li=(e,t)=>{e=e.toUpperCase(),si(Ni,e),si(`#${R}`,e),$(`${Ni} option[value="${e}"]`).attr("selected",!0),m("filters")[e]=JSON.stringify(t),fi(e,m("filters")[e])},ki=async function(e,t){if("_default"===e)return(()=>{p("BuyerSettings",Object.assign({},l)),p("CommonSettings",Object.assign({},c));const e=f();E(e)})(),!1;m("runnerToggle")||t||await _i();const i=m("filters")[e];if(!i)return!1;let{searchCriteria:{criteria:n,playerData:s,buyerSettings:o}}=JSON.parse(i);if(this.viewmodel.resetSearch(),this.viewDidAppear(),this.viewmodel.playerData={},Object.assign(this.viewmodel.searchCriteria,n),Object.assign(this.viewmodel.playerData,s),$.isEmptyObject(this.viewmodel.playerData)&&(this.viewmodel.playerData=null),this.viewDidAppear(),t)return;await Bi();const r=m("CommonSettings")||{};if(p("BuyerSettings",o),p("currentFilter",e),o=Object.assign({},o,r),E(o),o.idAddIgnorePlayersList&&o.idAddIgnorePlayersList.length)for(let{displayName:e}of o.idAddIgnorePlayersList)si(`#${at}`,e);return Fi(),!0},Wi=async function(){const e=$(`${Ni} option`).filter(":selected").val();if("_DEFAULT"===e.toLocaleUpperCase())return Vi("Cannot delete _DEFAULT filter",UINotificationType.NEGATIVE);"Choose filter to load"!=e&&($(`${Ni} option[value="${e}"]`).remove(),$(`${Ni}`).prop("selectedIndex",0),await _i(),this.viewDidAppear(),delete m("filters")[e],$(`${Ri} option[value="${e}"]`).remove(),oi(),(e=>{di(e)})(e),Vi("Changes saved successfully"))};let Oi=null;const Vi=function(e,t){t=t||UINotificationType.POSITIVE,services.Notification.queue([e,t])},Hi=e=>{services.PIN.sendData(PINEventType.PAGE_VIEW,{type:PIN_PAGEVIEW_EVT_TYPE,pgid:e})},ji=(e,t,i)=>{const n=f();(n.idAbMessageNotificationToggle||i)&&(d?Gi(e):qi(n,t,e),i&&Vi("Test Notification Sent"))},Gi=e=>{window.ReactNativeWebView.postMessage(JSON.stringify({type:"Notification",message:e}))},Ji=(e,t,i)=>{let n={embeds:[{description:e,color:t?2555648:16711680,footer:{text:`Auto Buyer Alert - ${(new Date).toLocaleTimeString()}`,icon_url:"https://cdn.discordapp.com/icons/768336764447621122/9de9ea0a7c6239e2f2fbfbd716189e79.webp"}}],avatar_url:"https://cdn.discordapp.com/icons/768336764447621122/9de9ea0a7c6239e2f2fbfbd716189e79.webp",username:"Fut Market Alert"};return i&&delete n.username,n},zi=e=>{const{embeds:[t]}=e;return(new Discord.RichEmbed).setColor(t.color).setDescription(t.description).setFooter(t.footer.text,t.footer.icon_url)},qi=(e,t,i)=>{const n=e.idTelegramBotToken,s=e.idTelegramChatId,o=e.idWebHookUrl,r=e.idDiscordChannelId,a=e.idFUTMarketAlertToken,l=e.idAbCustomDiscordNameNotificationToggle;Yi(n,s,i),Ki(r,t,i,l),Xi(o,t,i,l),Zi(a,i)},Yi=(e,t,i)=>{if(e&&t){const n=`https://api.telegram.org/bot${e}/sendMessage?chat_id=${t}&parse_mode=Markdown&text=${i}`,s=new XMLHttpRequest;s.open("GET",n,!0),s.send()}},Xi=(e,t,i,n)=>{e&&fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ji(i,t,n))})},Ki=(e,t,i,n)=>{if(e)if(Oi){const s=Oi.channels.get(e);s&&s.send(zi(Ji(i,t,n)))}else Oi=Qi(()=>{setTimeout(()=>{if(Oi){const s=Oi.channels.get(e);s&&s.send(zi(Ji(i,t,n)))}},200)})},Qi=e=>{const t=f(),i=new Discord.Client;let n=t.idDiscordToken;if(!n)return null;try{i.login(n),i.on("ready",function(){e&&e()}),i.on("message",async function(e){if(e.author.id!=i.user.id)if(/start/i.test(e.content)){const t=m("AutoBuyerInstance");qn.call(t),e.channel.send(zi(Ji("Bot started successfully",!0)))}else if(/stop/i.test(e.content))Yn(),e.channel.send(zi(Ji("Bot stopped successfully",!0)));else if(/runfilter/i.test(e.content)){let t=e.content.split("-")[1];if(t){t=t.toUpperCase(),Yn(),p("selectedFilters",[]);const i=m("AutoBuyerInstance");if(!await ki.call(i,t))return void e.channel.send(zi(Ji(`unable to find filter${t}`,!1)));qn.call(i),e.channel.send(zi(Ji(`${t} started successfully`,!0)))}else e.channel.send(zi(Ji("Unable to find filter name",!1)))}})}catch(e){}return i},Zi=(e,t)=>{e&&fetch("https://exp.host/--/api/v2/push/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([{to:`ExponentPushToken[${e}]`,title:t,body:t}])})},en=function(e){ji("Captcha, please solve the problem so that the bot can work again.",!1),e?window.location.href="about:blank":tn("[!!!] Autostopping bot since Captcha got triggered",he)},tn=function(e,t,i,n){setTimeout(()=>{var s=$("#"+t);const o=$(`\n              <li class="cardPalyerLi">\n              <div class="cardPalyer" style="${"success"===n?"border: solid #10AC84;":"error"===n?"border: solid #EE5253;":"warning"===n?"border: solid #FF9F43;":"border: solid #2E86DE;"}">\n              ${i?`<img\n                  style="width:30%; padding-left: 15px;"\n                  src="https://www.ea.com/ea-sports-fc/ultimate-team/web-app/content/24B23FDE-7835-41C2-87A2-F453DFDB2E82/2024/fut/items/images/mobile/portraits/${i?._metaData?.id}.png"\n                />`:""}\n              \n              <div class="container">\n                <span class="contentContainer" >${e}</span>\n                <div class="typeContent" style="${"success"===n?"background: #10AC84;":"error"===n?"background: #EE5253;":"warning"===n?"background: #FF9F43;":"background: #2E86DE;"}">\n                  <span class="typeContentText">${"success"===n?"✓":"error"===n?"X":"warning"===n?"!":"↻"}</span>\n                </div>\n              </div>\n              </div>\n              </li>\n          `);s.append(o),s[0]&&s.scrollTop(s[0].scrollHeight)},50)},nn=()=>{$("#"+he).val(""),Vt()};setInterval(()=>{const e=f();e&&e.idAutoClearLog&&nn()},12e4);const sn=()=>{let e=m("userPlatform");return e||(services.User.getUser().getSelectedPersona().isPC?(p("userPlatform","pc"),"pc"):(p("userPlatform","ps"),"ps"))},on=()=>new Promise(e=>{services.User.requestCurrencies().observe(void 0,function(t,i){e()})});let rn,an;const ln=function(e){if(!m("autoBuyerActive"))return;const t=1e3*C(e.idAbPauseFor);an=an||T(e.idAbCycleAmount);const{searchCount:i,previousPause:n}=m("sessionStats");return!i||(i-n)%an?void 0:(Lt("previousPause",i),on(),Yn(!0),setTimeout(()=>{an=T(e.idAbCycleAmount),qn.call(this,!0)},t))},cn=async function(){const e=m("selectedFilters"),t=m("fiterSearchCount"),i=m("currentFilterCount");if(!e||!e.length||t>i)return g("currentFilterCount"),!1;p("currentFilterCount",1),p("currentPage",1);const n=m("currentFilterIndex")||0;let s=m("runSequentially")?n%e.length:B(0,e.length-1);p("currentFilterIndex",s+1);let o=e[s];return await ki.call(this,o),tn(`Running for filter ${o}`,he),!0},dn="MAGIC_BUYER_BACKGROUND_FETCH";let un=0;const pn=async e=>{d?mn(e):await fn(e)},mn=e=>{p(e.identifier,e.onload),delete e.onload,window.ReactNativeWebView.postMessage(JSON.stringify({type:"fetchFromExternalAB",payload:{options:e}}))},fn=async e=>{try{const i=await(t={method:e.method,url:e.url,headers:e.headers,body:e.data},new Promise((e,i)=>{const n=`${dn}_${Date.now()}_${un++}`,s=t=>{if(t.source!==window||!t.data)return;const{type:o,id:r,success:a,payload:l,error:c}=t.data;"MAGIC_BUYER_BACKGROUND_FETCH_RESPONSE"===o&&r===n&&(window.removeEventListener("message",s),a?e(l):i(new Error(c||"Background fetch failed")))};window.addEventListener("message",s),window.postMessage({type:dn,id:n,payload:t},"*")}));e.onload?.({status:i.status,response:i.body,responseText:i.body,responseHeaders:i.headersRaw})}catch(t){e.onerror?e.onerror(t):console.error("Failed to perform external request",t)}var t},gn=(e,t,i)=>new Promise((n,s)=>{pn({method:t,identifier:i,url:e,onload:e=>200!==e.status?s():n(e.response)})}),bn=async(e,t)=>{try{const i=await hn(e),n=sn();if(!i)return;const s=await gn(`https://www.futwiz.com/en/app/sold23/${i[0].lineid}/console`,"GET",`${e.definitionId}_fetchFutWizPlayerPrices`),o=JSON.parse(s);let r=o.prices[n].bin;"ps"!==n||r||(r=o.prices.xb.bin);const a=parseInt(r.replace(/[,.]/g,"")),l=`${e.definitionId}_futwiz_price`,c={expiryTimeStamp:new Date(Date.now()+9e5),price:a};p(l,c),t.set(l,a)}catch(e){console.log(e)}},hn=e=>new Promise((t,i)=>{const n=TextUtils.stripSpecialCharacters("---"!==e._staticData.knownAs?e._staticData.knownAs:e._staticData.name);pn({url:`https://www.futwiz.com/en/searches/player23/${n}`,method:"GET",identifier:`${e.definitionId}_getFutWizPlayerUrl`,onload:i=>{if(200!==i.status)return t();const n=JSON.parse(i.response);if(!n)return t();let s=n.filter(t=>parseInt(t.rating)===e.rating);n&&!s.length&&(s=n),s&&s.length>1&&(s=s.filter(t=>t.rare===e.rareflag.toString()&&t.club===e.teamId+"")),t(s)}})}),yn=async e=>{const t=new Map,i=new Map;let n=[];for(const n of e){if(!n.definitionId)continue;const e=m(`${n.definitionId}_futwiz_price`);e?t.set(`${n.definitionId}_futwiz_price`,e.price):n.isPlayer()&&i.set(n.definitionId,n)}if(i.size)for(const e of i.values())n.push(bn(e,t));return await Promise.all(n),t},vn=e=>{const t=services.Localization;return t?e.isManagerContract()?t.localize("card.title.managercontracts"):e.isPlayerContract()?t.localize("card.title.playercontracts"):e.isStyleModifier()?UTLocalizationUtil.playStyleIdToName(e.subtype,t):e.isPlayerPositionModifier()?t.localize("card.desc.training.pos."+e._staticData.trainPosFrom+"_"+e._staticData.trainPosTo).replace(" >> ","->"):e._staticData.name:""},Sn=(e,t,i)=>e>=t&&e<=i,wn=new Set(["Position","Chemistry Style"]),$n=async(e,t)=>{const i=Array.from(e),n=sn();for(;i.length;){const e=i.splice(0,30),s=e.shift();if(!s)continue;const o=e.join(",");try{const i=await gn(`https://www.futbin.com/24/playerPrices?player=${s}&rids=${o}`,"GET",`${Math.floor(+new Date)}_fetchPlayerPrices`),r=JSON.parse(i);for(const i of[s,...e]){const e=r[i].prices[n].LCPrice;if(!e)continue;const s=parseInt(e.replace(/[,.]/g,"")),o=`${i}_futbin_price`,a={expiryTimeStamp:new Date(Date.now()+9e5),price:s};p(o,a),t.set(o,s)}}catch(e){console.log(e)}}},An=async(e,t)=>{const i=sn(),n="ps"===i?"PS":"xbox"===i?"XB":"PC",s=Array.from(e.keys());for(const i of s)try{const s=i.split(" ")[0],o=await gn(`https://www.futbin.org/futbin/api/fetchConsumables?category=${s}&platformtype=${n}`,"GET",`${Math.floor(+new Date)}_fetchConsumablesPrices`),r=JSON.parse(o).data.reduce((e,t)=>(e.set(t.SubType.toUpperCase(),t.LCPrice),e),new Map),a=e.get(i)||[];for(const{definitionId:e,subType:i}of a){let n=r.get(i);const s=`${e}_futbin_price`;if(n){const e={expiryTimeStamp:new Date(Date.now()+9e5),price:n};p(s,e),t.set(s,n)}}}catch(e){console.log(e)}},Cn=async e=>{const t=new Map,i=new Set,n=new Map;for(const s of e){if(!s.definitionId)continue;const e=m(`${s.definitionId}_futbin_price`);e?t.set(`${s.definitionId}_futbin_price`,e.price):s.isPlayer()?i.add(s.definitionId):s.isTraining()&&wn.has(s._staticData.name)&&(n.has(s._staticData.name)||n.set(s._staticData.name,[]),n.get(s._staticData.name).push({definitionId:s.definitionId,subType:vn(s)}))}const s=[];return i.size&&s.push($n(i,t)),n.size&&s.push(An(n,t)),await Promise.all(s),t},Tn=async e=>{const t=b();return"FUTWIZ"===t?yn(e):"FUTBIN"===t?Cn(e):void 0},Pn=e=>{let t=JSUtils.find(UTCurrencyInputControl.PRICE_TIERS,function(t){return e>=t.min});var i=Math.round(e/t.inc)*t.inc;return Math.max(Math.min(i,14999e3),0)},_n=e=>e<=1e3?e-50:e>1e3&&e<=1e4?e-100:e>1e4&&e<=5e4?e-250:e>5e4&&e<=1e5?e-500:e-1e3,Bn=e=>e<1e3?e+50:e>=1e3&&e<1e4?e+100:e>=1e4&&e<5e4?e+250:e>=5e4&&e<1e5?e+500:e+1e3,In=async(e,t,i)=>{let n;try{const s=i.definitionId,o=b();if("player"!==i.type)return n;await Tn([i]);const r=m(`${s}_${o.toLowerCase()}_price`);if(r&&r.price){n=r.price;const s=T(e.idSellFutBinPercent)||100;let a=n*s/100;await xn(i),i.hasPriceLimits()&&(a=Pn(Math.min(i._itemPriceLimits.maximum,Math.max(i._itemPriceLimits.minimum,a))),a===i._itemPriceLimits.minimum&&(a=Bn(a))),a=Pn(a),tn(`= ${o} price for ${t}: ${n}: ${s}% of sale price: ${a}`,he),n=a}else n=null,tn(`= Unable to get ${o} price for ${t}`,he)}catch(e){e=e.statusText||e.status||e,n=null,tn(`= Unable to get Futbin price for ${t}, err: ${e||"error occured"}`,he)}return n},xn=async e=>new Promise(t=>{e.hasPriceLimits()?t():services.Item.requestMarketData(e).observe(void 0,async function(e,i){t()})}),Mn=e=>{const t=m("sessionStats");t.transactions=t.transactions||[],t.transactions.push(e),p("sessionStats",t)},Dn=()=>{const{coinsNumber:e,searchCount:t,profit:i,runningTime:n,transactions:s}=m("sessionStats");let o="Available Coins,Search Count,Profit,Running Time,BIN Won Count,BID Won Count,Loss Count\n";o+=`${e||""},${t||""},${i||0},${n||""},${m("winCount")||0},${m("bidCount")||0},${m("lossCount")||0}\n\n`,o+="Transactions\n",o+=s.map(e=>`${e}\n`).join(""),((e,t)=>{d?S(e,t):A(e,t)})(o,"Stats")};setInterval(()=>{const e=m("sessionStats");e.searchPerMinuteCount=0,p("sessionStats",e)},55e3);const En=new Map,Fn=(e,t,i,n,s,o)=>{const r=f();return new Promise(l=>{services.Item.bid(e,i).observe(void 0,async function(c,d){let u=x(i.toString(),6);const f=r.idNotificationType;if(d.success){s&&(g("purchasedCardCount"),M("cardWon"));const a=r.idSellRatingThreshold;let l=parseInt(e.rating);const c=!a||l<=a,d=r.idSellFutBinPrice;c&&d&&s&&(n=await In(r,t,e));r.idSellCheckBuyPrice&&i>95*n/100&&(n=-1);const b=n&&!isNaN(n)&&c,h=.95*n-i;if(s){const s=g("winCount");if(Mn(`[${(new Date).toLocaleTimeString()}] ${t.trim()} achat avec succès - Prix : ${i}`),Lt("winCount",s),tn(`<h2>${t}</h2> <br>Acheté à ${i} <br>Vendu à ${n} <br>Bénéfice de ${h}`,he,e,"success"),!r.idAbDontMoveWon){const i=m("sellQueue")||[];i.push({player:e,playerName:t,sellPrice:n,shouldList:b,profit:h}),p("sellQueue",i)}}else{const n=g("bidCount");Mn(`${t.trim()} succès de l'enchère - Prix : ${i}`),tn(`B:${n} ${t} succès de l'enchère`,he,e,"success");const s=m("currentFilter")||"default";if(s){const e=m("filterBidItems")||new Map;e.has(s)?e.get(s).add(o):e.set(s,new Set([o])),p("filterBidItems",e)}}"B"!==f&&"A"!==f||ji("| "+t.trim()+" | "+u.trim()+` | ${s?"buy":"bid"} |`,!0)}else{g("lossCount");Mn(`[${(new Date).toLocaleTimeString()}] ${t.trim()} buy failed - Price : ${i}`);let n=(d.error&&d.error.code||d.status)+"";if(tn(`${t} - échec de l'${s?"achat":"enchère"} - ERR: (${a[n]+"("+n+")"||0})`,he,e,"error"),"L"!==f&&"A"!==f||ji("| "+t.trim()+" | "+u.trim()+" | failure |",!1),r.idAbStopErrorCode){const t=new Set(r.idAbStopErrorCode.split(","));if(En.has(n)||En.set(n,{currentVal:0}),En.get(n).currentVal++,t.has(n)&&En.get(n).currentVal>=r.idAbStopErrorCodeCount&&(tn(`[!!!] Autostopping bot since error code ${n} has occured ${En.get(n).currentVal} times\n`,he,e,"error"),En.clear(),Yn(),r.idAbResumeAfterErrorOccured)){const t=C(r.idAbResumeAfterErrorOccured);tn(`Le bot reprendra dans ${t}(s)`,he,e,"error"),setTimeout(()=>{qn.call(m("AutoBuyerInstance"))},1e3*t)}}}r.idAbAddBuyDelay&&await y(_(r.idAbDelayToAdd)),l()})})},Nn=new Set,Rn=function(e){return Hi("Transfer Targets - List View"),new Promise(t=>{services.Item.clearTransferMarketCache(),services.Item.requestWatchedItems().observe(this,function(i,n){let s=e.idAbMaxBid,o=e.idAbSellPrice,r=n.response.items.filter(function(e){return!!e._auction});if(!r.length)return t();services.Item.refreshAuctions(r).observe(this,function(i,n){services.Item.requestWatchedItems().observe(this,async function(i,n){const r=m("autoBuyerActive"),a=m("currentFilter")||"default",l=(m("filterBidItems")||new Map).get(a)||new Set,c=m("userWatchItems");if(r&&s){let t=n.response.items.filter(function(e){return"outbid"===e._auction._bidState&&(!a||l.has(e._auction.tradeId))&&!c.has(e._auction.tradeId)&&"active"===e._auction._tradeState});if(t.length){const i=t[B(0,t.length-1)];await Un(i,s,o,e)}}const d=e.idSellFutBinPrice;if(r&&!e.idAbDontMoveWon&&(o&&!isNaN(o)||d)){let t=n.response.items.filter(function(e){return e.getAuctionData().isWon()&&(!a||l.has(e._auction.tradeId))&&!c.has(e._auction.tradeId)&&!Nn.has(e._auction.tradeId)});for(var u=0;u<t.length;u++){const i=t[u],n=e.idSellRatingThreshold;let s=parseInt(i.rating);const r=!n||s<=n;let a=x(i._staticData.name,15),l=i._auction.currentBid;r&&d&&(o=await In(e,a,i));e.idSellCheckBuyPrice&&l>95*o/100&&(o=-1);const c=o&&!isNaN(o)&&r;if(c&&Nn.add(i._auction.tradeId),!e.idAbDontMoveWon){const e=m("sellQueue")||[],t=.95*o-l;e.push({player:i,sellPrice:o,playerName:a,shouldList:c,profit:t}),p("sellQueue",e)}}}let f=n.response.items.filter(e=>{var t=e.getAuctionData();return t.isExpired()||t.isClosedTrade()&&!t.isWon()});e.idAutoClearExpired&&f.length&&(services.Item.untarget(f),tn(`${f.length} élément(s) expirés et supprimés de la liste d'objectifs`,he)),services.Item.clearTransferMarketCache(),t()})})})})},Un=async(e,t,i,n)=>{let s=e._auction,o=s.currentBid,r=s.currentBid||s.startingBid,a=x(e._staticData.name,15);const l=m("autoBuyerActive");let c=n.idAbBidExact?t:o?_n(t):t,d=n.idAbBidExact?t:o?Bn(r):r;l&&r<=c&&(tn("Enchèr sur un élement en surenchère -> Prix d'enchère :"+d,he),await Fn(e,a,d,i),n.idAbAddBuyDelay&&await y(1))},Ln=()=>{const e=f();let t=e.idAntiCaptchKey,i=e.idProxyAddress,n=e.idProxyPort,s=e.idProxyLogin,o=e.idProxyPassword;if(!i||!n||!t)return tn("Proxy info not filled properly",he),void en(e.idAbCloseTabToggle);function r(e){let i={clientKey:t,taskId:e};var n=new XMLHttpRequest;n.open("POST","https://api.anti-captcha.com/getTaskResult",!0),n.setRequestHeader("Content-Type","application/json"),n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){var t=JSON.parse(n.responseText);if(0==t.errorId)if("ready"==t.status){new UTCaptchaViewModel(accessobjects.Captcha).validateToken(t.solution.token).observe(this,function(e,t){if(t.success){tn("Captcha Solved",he);const e=m("AutoBuyerInstance");qn.call(e)}})}else setTimeout(()=>r(e),1e3);else tn("Error occured when checking captcha result : "+t.errorCode+", "+t.errorDescription,he)}};var s=JSON.stringify(i);n.send(s)}!function(){accessobjects.Captcha.getCaptchaData().observe(this,function(e,a){if(a.success){if(!(c=a.response.blob))return!1;let e={clientKey:t,task:{type:"FunCaptchaTask",websiteURL:"https://www.ea.com/ea-sports-fc/ultimate-team/web-app/",websitePublicKey:"A4EECF77-AC87-8C8D-5754-BF882F72063B",funcaptchaApiJSSubdomain:"ea-api.arkoselabs.com",data:a.response,proxyType:"http",proxyAddress:i,proxyPort:n,proxyLogin:s,proxyPassword:o,userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36"}};var l=new XMLHttpRequest;l.open("POST","https://api.anti-captcha.com/createTask",!0),l.setRequestHeader("Content-Type","application/json"),l.onreadystatechange=function(){if(4===l.readyState&&200===l.status){var e=JSON.parse(l.responseText);0==e.errorId?r(e.taskId):tn("Got error from Captcha API: "+e.errorCode+", "+e.errorDescription,he)}};var c=JSON.stringify(e);return l.send(c),!0}})}()},kn=new Set,Wn=function(e){return new Promise(t=>{const i=_(e.idAbItemExpiring),n=e.idAbRandMinBidToggle,s=e.idAbRandMinBuyToggle,o=e.idBuyFutBinPercent||100;let r=m("currentPage")||1;kt("searchPerMinuteCount")>15&&(e.idAbOverSearchWarning||void 0===e.idAbOverSearchWarning)&&tn("<h2>Attention !</h2> <br>Plus de 15 recherches effectuées en une minute, vous devez augmenter votre temps d'attente entre les recherches !",he,null,"warning");const a=new Set((e.idAddIgnorePlayersList||[]).map(({id:e})=>e)),l=b();let c=e.idAbMaxBid,d=e.idAbBuyPrice,u=e.idBuyFutBinPrice||e.idAbBidFutBin;if(!d&&!c&&!u)return tn("skip search >>> (No Buy or Bid Price given)",he),t();Hi("Transfer Market Search"),(()=>{const e=m("sessionStats");e.searchCount++,e.searchPerMinuteCount++,p("sessionStats",e)})();let f=this.viewmodel.searchCriteria;n&&(f.minBid=Pn(B(0,e.idAbRandMinBidInput))),s&&(f.minBuy=Pn(B(0,e.idAbRandMinBuyInput))),services.Item.clearTransferMarketCache(),services.Item.searchTransferMarket(f,r).observe(this,async function(n,s){if(s.success){p("searchFailedCount",0);let t=!0;tn(`<h2>Aucun élément trouvé !</h2> <br>Page n°${r} <br>Enchère min à ${f.minBid} <br>Achat immédiat min à ${f.minBuy}`,he),s.data.items.length>0&&(1===r&&Hi("Transfer Market Results - List View"),u&&"player"===s.data.items[0].type&&await Tn(s.data.items)),s.data.items.length>e.idAbSearchResult&&(t=!1);let n=e.idAbMaxPurchases||1;e.idAbShouldSort&&(s.data.items=((e,t,i)=>{let n=e=>e._auction.buyNowPrice;return"bid"===t?n=e=>e._auction.currentBid||e._auction.startingBid:"rating"===t?n=e=>parseInt(e.rating):"expires"===t&&(n=e=>parseInt(e._auction.expires)),e.sort((e,t)=>{const s=n(e),o=n(t);return i?s-o:o-s}),e})(s.data.items,e.idAbSortBy||"buy",e.idAbSortOrder));for(let r=s.data.items.length-1;r>=0&&m("autoBuyerActive");r--){let p=s.data.items[r],f=p._auction,g=services.Localization.localizeAuctionTimeRemaining(f.expires),b=p.type,{id:h}=p._metaData||{},y=parseInt(p.rating);if(u&&"player"===b){const t=m(`${p.definitionId}_${l.toLowerCase()}_price`);if(!t||!t.price){tn(`Price unavailable for ${p._staticData.name}`,he);continue}{const i=Pn(t.price*o/100);d=i,e.idAbBidFutBin&&(c=i)}}let v=f.buyNowPrice,S=f.currentBid||f.startingBid,w=f.currentBid,$=e.idAbBidExact?c:w?_n(c):c,A=e.idAbBidExact?$:w?Bn(S):S,C=e.idAbSellPrice,T=e.idAbMinRating,P=e.idAbMaxRating,_=p._staticData.name;const B=!(T||P)||Sn(y,T,P),I=On(`${_}(${y}) Prix: ${v} temps: ${g}`);if(!e.idAbIgnoreAllowToggle&&a.has(h)||e.idAbIgnoreAllowToggle&&!a.has(h)){I("(Joueur ignoré)");continue}if(!t){I("(Seuil de résultats de recherche dépassé)");continue}if(n<1)break;if(!p.preferredPosition&&e.idAbAddFilterGK){I("(est un Gardien)");continue}if(!B){I("(la note ne correspond pas aux critères)");continue}if(kn.has(f.tradeId)){I("(Cached Item)");continue}const x=services.User.getUser().coins.amount;if(!c&&x<v||c&&x<A)I("(Coins insuffisants pour acheter/enchérir)");else if(v<=d)I("essaye d'achat à: "+v),n--,kn.add(f.tradeId),await Fn(p,_,v,C,!0,f.tradeId);else if(c&&S<=$){if(f.expires>i){I("(Attente de l'heure d'expiration spécifiée)");continue}I("tentative d'enchère à: "+A),kn.add(f.tradeId),n--,await Fn(p,_,A,C,A===v,f.tradeId)}else I(d&&v>d||c&&S>$?`Prix d'achat: ${d||$} (supérieur au prix d'achat/offre spécifié)`:"(Aucune action requise)")}}else((e,t,i)=>{let n=!1;if(e.status===UtasErrorCode.CAPTCHA_REQUIRED||e.error&&e.error.code==UtasErrorCode.CAPTCHA_REQUIRED)n=!0,t?(tn("[!!!] Captcha got triggered, trying to solve it",he),Ln()):en(i);else{const t=g("searchFailedCount");t>=3?(n=!0,tn(`[!!!] Autostopping bot as search failed for ${t} consecutive times, please check if you can access transfer market in Web App ${e.status}`,he)):tn(`[!!!] Search failed - ${e.status}`,he)}n&&(M("capatcha"),Yn())})(s,e.idAbSolveCaptcha,e.idAbCloseTabToggle);Hi("Transfer Market Search"),r<e.idAbMaxSearchPage&&21===s.data.items.length?g("currentPage"):p("currentPage",1),t()})})},On=e=>t=>{tn(e+" "+t,he)},Vn=function(e,t,i){return Hi("Transfer List - List View"),new Promise(n=>{i||repositories.Item.isDirty(ItemPile.TRANSFER)?services.Item.requestTransferItems().observe(this,async function(i,s){let o=s.response.items.filter(function(e){return e.getAuctionData().isSold()}).length;kt("soldItems")<o&&await on(),Lt("soldItems",o);const r=s.response.items.filter(function(e){return!e.getAuctionData().isSold()&&e.getAuctionData().isExpired()}).length;Lt("unsoldItems",r);const a=o>=t;r&&e&&services.Item.relistExpiredAuctions().observe(this,function(e,t){!a&&UTTransferListViewController.prototype.refreshList()});const l=s.response.items.filter(function(e){return e.getAuctionData().isSelling()}).length;Lt("activeTransfers",l);const c=s.response.items.filter(function(e){return e.getAuctionData().isInactive()}).length;Lt("availableItems",c);const d=services.User.getUser().coins.amount;Lt("coinsNumber",d),Lt("coins",d.toLocaleString()),a&&(tn("[TRANSFER-LIST] > "+o+" item(s) sold\n",he),UTTransferListViewController.prototype._clearSold()),n()}):n()})},Hn=function(){return{switchFilterWithContext:cn.bind(this),srchTmWithContext:Wn.bind(this),watchListWithContext:Rn.bind(this),transferListWithContext:Vn.bind(this),pauseBotWithContext:ln.bind(this)}},jn=async()=>{const e=m("sellQueue")||[],t=f();t.idAbSendListingNotificationToggle,e.length;for(;e.length;){const{player:i,sellPrice:n,shouldList:s,playerName:o,profit:r}=e.pop();await Gn(i,n,r,s,t);e.length&&await y(2)}},Gn=(e,t,i,n,s)=>new Promise(o=>{if(t<0)services.Item.move(e,ItemPile.TRANSFER).observe(void 0,async function(){o()});else if(n){if(repositories.Item.isPileFull(ItemPile.TRANSFER))return o("Unable to list, transfer List if Full");(e=>{const t=m("sessionStats");t.profit+=e,p("sessionStats",t)})(i),services.Item.list(e,_n(t),t,_(s.idFutBinDuration||"1H")||3600).observe(void 0,async function(e,t){o()})}else services.Item.move(e,ItemPile.CLUB).observe(void 0,async function(e,t){o()})});let Jn=null,zn=null;const qn=async function(e){$("#"+Ee).css("color","#2cbe2d").html("RUNNING");if(m("autoBuyerActive"))return;(e=>{Vi(e?"Autobuyer Resumed":"Autobuyer Started"),p("autoBuyerActive",!0),p("autoBuyerState","Active"),isPhone()&&$(".ut-tab-bar-item").attr("disabled",!0),e||(p("botStartTime",new Date),p("purchasedCardCount",0),p("searchFailedCount",0),p("currentPage",1))})(e);const{switchFilterWithContext:t,srchTmWithContext:i,watchListWithContext:n,transferListWithContext:s,pauseBotWithContext:o}=Hn.call(this);await t();let r=f();!e&&await new Promise((e,t)=>{services.Item.requestWatchedItems().observe(void 0,function(t,i){if(i.success){const e=m("filterBidItems")||new Map,t=new Set(Array.from(e.values()).flat(1).reduce((e,t)=>e.concat([...t]),[])),n=i.response.items.filter(e=>e._auction&&!t.has(e._auction.tradeId)).map(e=>e._auction.tradeId)||[];p("userWatchItems",new Set(n)),n.length&&tn(`${n.length} élément(s) trouvé(s) dans la liste d'objectifs de transferts et ignoré(s)`,he)}e()})}),Hi("Hub - Transfers"),await i(r),Hi("Hub - Transfers"),await s(r.idAbSellToggle,r.idAbMinDeleteCount,!0);let a=!1;m("autoBuyerActive")&&(Jn=((e,t,i)=>{let n,s=!1;const o=()=>{if(s)return;const r={start:Date.now()},a=1e3*parseFloat((Math.random()*(i-t)+t).toFixed(1));r.end=r.start+a,p("searchInterval",r),n=setTimeout(()=>{e(),o()},a)};return o(),{clear(){s=!0,clearTimeout(n)}}})(async()=>{zn=o(r),(e=>{const t=m("purchasedCardCount"),i=e.idAbCardCount,n=m("botStartTime").getTime();let s=rn||C(e.idAbStopAfter);rn||(rn=s);let o=((new Date).getTime()-n)/1e3>=s;(o||i&&t>=i)&&(tn("Autobuyer stopped | "+(o?"Time elapsed":"Max purchases count reached"),he),rn=null,an=null,Yn())})(r);m("autoBuyerActive")&&!a&&(a=!0,await jn(),await t(),r=f(),Hi("Hub - Transfers"),await i(r),Hi("Hub - Transfers"),await n(r),Hi("Hub - Transfers"),await s(r.idAbSellToggle,r.idAbMinDeleteCount)),a=!1},...I(r.idAbWaitTime)))},Yn=e=>{Jn&&Jn.clear(),!e&&zn&&clearTimeout(zn);const t=m("autoBuyerState");if(e&&t===o||!e&&t===r)return;p("autoBuyerActive",!1);const i=m("searchInterval")||{};p("searchInterval",{start:i.start,end:Date.now()}),e||M("finish"),isPhone()&&$(".ut-tab-bar-item").removeAttr("disabled"),p("autoBuyerState",e?o:r),Vi(e?"Autobuyer Paused":"Autobuyer Stopped"),e||jn(),$("#"+Ee).css("color","red").html(e?"PAUSED":"IDLE")},Xn=()=>`<span style='color:red' id="${Ee}"> IDLE </span> | REQUEST COUNT: <span id="${xe}">0</span> \n  `,Kn=()=>isPhone()?Qn():Zn(),Qn=()=>`<div class="view-navbar-currency">\n            <span id=${St} style="font-weight: bold;\n            margin: auto 2px;">00:00:00</span>\n            <div style="margin: auto 2px;">Search:</div> \n            <div class="stats-progress">\n              <div id=${Be} class="stats-fill"></div>\n            </div>\n            <div class="view-navbar-currency-coins ab">Coins: <span id=${Me}></span></div>\n            <div class="view-navbar-currency-coins ab">Profit: <span id=${it}></span></div>\n            <div class="view-navbar-currency-coins ab">Won: <span id=${De}></span></div>\n            ${ei(wt,"⇩",()=>{Dn()},"filterSync download-stats")} \n          </div>`,Zn=()=>`\n  <div class="view-navbar-clubinfo-data">\n    <div class="view-navbar-clubinfo-name">\n    ${ei(wt,"⇩",()=>{Dn()},"filterSync")}\n    </div>\n  </div>\n  <div class="view-navbar-clubinfo">\n    <div class="view-navbar-clubinfo-data">\n      <div class="view-navbar-clubinfo-name">\n        <span id=${St} style="font-weight: bold;">00:00:00</span>\n      </div>\n    </div>\n  </div>\n  <div class="view-navbar-clubinfo">\n    <div class="view-navbar-clubinfo-data">\n       <div class="view-navbar-clubinfo-name">\n          <div style="float: left;">Search:</div>\n          <div class="stats-progress">\n             <div id=${Be} class="stats-fill"></div>\n          </div>\n       </div>\n       <div class="view-navbar-clubinfo-name">\n          <div style="float: left;">Statistics:</div>\n          <div class="stats-progress">\n             <div id=${Ie} class="stats-fill"></div>\n          </div>     \n       </div>\n    </div>\n  </div>\n  <div class="view-navbar-currency" style="margin-left: 10px;">\n    <div class="view-navbar-currency-coins ab">Coins: <span  id=${Me}></span></div>\n    <div class="view-navbar-currency-coins ab">Profit: <span  id=${it}></span></div>\n    <div class="view-navbar-currency-coins ab">Won: <span id=${De}></span></div>\n  </div>\n  <div class="view-navbar-clubinfo">\n    <div class="view-navbar-clubinfo-data">\n       <span class="view-navbar-clubinfo-name">Sold Items: <span id=${Fe}></span></span>\n       <span class="view-navbar-clubinfo-name">Unsold Items: <span id=${Ne}></span></span>\n    </div>\n  </div>\n  <div class="view-navbar-clubinfo" style="border: none;">\n    <div class="view-navbar-clubinfo-data">\n       <span class="view-navbar-clubinfo-name">Available Items: <span id=${Re}></span></span>\n       <span class="view-navbar-clubinfo-name">Active transfers: <span id=${Ue}></span></span>\n    </div>\n  </div>`,{R:es,T:ts}=i;function is(){if(void 0===window.UTMarketSearchFiltersViewController)throw new Error("UT controllers not found. Open Ultimate Team web app first.");const e=window.UTMarketSearchFiltersViewController,t=function(t){e.call(this)},i=e.prototype.init,n=e.prototype.viewDidAppear;function s(e){n.call(this);let t=this.getView(),i=$(t.__root);i.find(".filter-place").length||wi.call(this,e).then(e=>{i.find(".ut-item-search-view").first().prepend(e)})}return window.JSUtils?.inherits?.(t,e),window.JSUtils?.inherits?.(e,e),t.prototype.init=function(){i.call(this);let e=this.getView();"function"==typeof window.isPhone&&window.isPhone()||(e.__root.style="width: 100%; float: left;"),p("AutoBuyerInstance",this);const t=Pi.call(this);let n=$(e.__root);const s=Wt.bind(this),o=s("Stop",()=>ts.call(this)),r=s("Clear Log",()=>nn.call(this),"btn-other"),a=s("Start",()=>{es.call(this),$(".ut-navigation-container-view--content").animate({scrollTop:$(".ut-navigation-container-view--content").prop("scrollHeight")},400)},"call-to-action");setInterval(()=>{isPhone()?Nt():Rt()},1e3),n.addClass("auto-buyer");const l=n.find(".button-container");l.addClass("buyer-actions"),l.find(".call-to-action").remove();const c=l.find('button:contains("Reset")');c.on("click touchend",async function(){$(`#${F}`).prop("selectedIndex",0),await _i()}),c.addClass("btn-other"),l.append($(a.__root)),l.append($(o.__root)),l.append($(r.__root)),$(t.__root).find(".menu-container").addClass("settings-menu"),n.find(".search-prices").append(t.__root)},t.prototype.viewDidAppear=function(){this.getNavigationController().setNavigationVisibility(!0,!0),s.call(this,!1)},e.prototype.viewDidAppear=function(){s.call(this,!0)},t.prototype.getNavigationTitle=function(){return setTimeout(()=>{const e=$(".title");"function"==typeof window.isPhone&&window.isPhone()&&e.addClass("buyer-header"),$(".view-navbar-currency").remove(),$(".view-navbar-clubinfo").remove(),e.append(Xn()),$(Kn()).insertAfter(e),$(".ut-navigation-container-view--content").find(`#${Mt}`).remove(),$(".ut-navigation-container-view--content").append(Ot()),Vt(),E(m("CommonSettings")||{})}),"MagicBuyer "},t}async function ns(){!function(){const e=Array.from(document.querySelectorAll(".ut-tab-bar-item")).find(e=>"MagicBuyer"===e.textContent?.trim());e&&(e.dispatchEvent(new MouseEvent("click",{bubbles:!0})),e.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0})),e.dispatchEvent(new MouseEvent("mouseup",{bubbles:!0})))}();let e=m("AutoBuyerInstance");if(!e||!e.__mbDevMounted){const t=is(),i=window._navigationController||window.navigationController;if(!i?.pushViewController)throw new Error("Navigation controller not found.");e=new t,i.pushViewController(e,!0),e.__mbDevMounted=!0,p("AutoBuyerInstance",e)}const t=document.querySelector(".title");if(t&&!t.querySelector(".buyer-header")){try{t.appendChild(Xn())}catch{}try{$(Kn()).insertAfter($(t))}catch{}}const i=document.querySelector(".ut-navigation-container-view--content");i&&!i.querySelector(`#${Mt}`)&&(i.appendChild(Ot()),Vt());const n=document.querySelector(".ut-item-search-view");if(n&&!n.querySelector(".settings-menu")){await _i();const t=Pi.call(e),i=document.querySelector(".search-prices")||n,s=t?.__root||t;s&&(s.querySelector?.(".menu-container")?.classList?.add("settings-menu"),i.appendChild(s))}}window.addEventListener("message",e=>{if(e.source!==window||!e.data)return;const{type:t,payload:i}=e.data;if("MAGIC_BUYER_PAGE_COMMAND"!==t)return;const n=i?.command;"openSettings"===n&&Promise.resolve().then(()=>ns()).catch(e=>console.error("[MagicBuyer] openSettings error:",e))})})();